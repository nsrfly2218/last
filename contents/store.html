<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>إعداد SKU - المحتويات</title>
    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <style>
        .wd-search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .wd-search-input {
            position: relative;
            flex: 1;
            min-width: 250px;
        }

        .wd-search-input i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .wd-search-input input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .wd-search-input input:focus {
            outline: none;
            border-color: #25d366;
            box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.1);
        }

        .wd-filter-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .wd-filter-select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
            color: #333;
            font-size: 14px;
            min-width: 150px;
        }

        .wd-table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .wd-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto;
        }

        .wd-table th {
            background: #f8f9fa;
            padding: 8px;
            text-align: right;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #eee;
            vertical-align: middle;
        }

        .wd-table td {
            padding: 8px;
            border-bottom: 1px solid #eee;
            color: #555;
            text-align: right;
            vertical-align: middle;
        }

        .wd-table tr:hover {
            background-color: #f8f9fa;
        }

        .wd-variable-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .wd-variable-name {
            font-weight: 500;
            color: #333;
            font-family: var(--font-family);
        }

        .wd-variable-description {
            font-size: 13px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 300px;
        }

        .wd-variable-value {
            font-family: var(--font-family);
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            color: #333;
        }

        .wd-variable-type {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 4px;
            background: #f0f0f0;
            font-size: 12px;
        }

        .wd-variable-type i {
            color: #25d366;
        }

        .wd-btn-icon {
            padding: 8px;
            margin: 0 5px;
            border-radius: 6px;
            color: #666;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .wd-btn-icon:hover {
            background: #f0f0f0;
            color: #333;
        }

        .wd-btn-icon i {
            font-size: 16px;
        }

        .wd-btn-icon[title]:hover:after {
            content: attr(title);
            position: absolute;
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 5px;
            z-index: 1;
        }

        .wd-sku-actions {
            display: inline-flex;
            gap: 5px;
            align-items: center;
            justify-content: center;
        }

        .wd-btn-icon.edit {
            color: #666;
        }

        .wd-btn-icon.edit:hover {
            background: #f0f0f0;
            color: #333;
        }

        .wd-btn-icon.save {
            color: #666;
        }

        .wd-btn-icon.save:hover {
            background: #f0f0f0;
            color: #333;
        }

        .wd-btn-icon.delete {
            color: #666;
        }

        .wd-btn-icon.delete:hover {
            background: #f0f0f0;
            color: #333;
        }

        .wd-sku-color {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .wd-color-display {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .wd-color-preview {
            width: 26px;
            height: 16px;
            border-radius: 3px;
            border: 1px solid #ddd;
            display: inline-block;
        }

        .wd-editable-input {
            width: 100%;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            background: transparent;
            box-sizing: border-box;
        }

        .wd-editable-input:focus {
            outline: none;
        }

        .wd-editable-color {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .wd-color-input {
            width: 40px;
            height: 28px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .wd-sku-value,
        .wd-product-name,
        .wd-color-display {
            font-weight: 500;
            font-size: 13px;
        }

        /* تبويبات المتجر */
        .wd-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            border-bottom: 1px solid #eee;
        }

        .wd-tab {
            border: 1px solid #ddd;
            border-bottom: none;
            background: #f5f5f5;
            padding: 8px 16px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 14px;
            color: #555;
            transition: all 0.2s ease;
        }

        .wd-tab:hover {
            background: #e9f7ef;
            color: #111;
        }

        .wd-tab.wd-tab-active {
            background: #fff;
            color: #111;
            border-color: #25d366;
            border-bottom-color: #fff;
            font-weight: 600;
        }

        .wd-tab-content {
            display: none;
            padding: 20px 0 0 0;
            margin-top: -1px;
        }

        .wd-tab-content.wd-tab-content-active {
            display: block;
        }

        .wd-tab-content-title {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .wd-tab-content-description {
            color: #666;
            font-size: 14px;
        }

        /* حالة الطلب - مظهر أفضل */
        .wd-order-status {
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid #ddd;
            background-color: #f8f9fa;
            font-size: 12px;
            color: #333;
            outline: none;
            cursor: pointer;
        }

        .wd-order-status:focus {
            border-color: #25d366;
            box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.15);
        }

        /* ألوان تقريبية للحالات حسب القيمة (يمكن تعديلها لاحقاً) */
        .wd-order-status.option-new {
            background-color: #e3f2fd;
            color: #1565c0;
        }

        .wd-order-status.option-processing {
            background-color: #fff3cd;
            color: #856404;
        }

        .wd-order-status.option-completed {
            background-color: #d4edda;
            color: #155724;
        }

        .wd-order-status.option-cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* نسب أعمدة جدول الطلبات فقط */
        .wd-orders-table th:nth-child(1) {
            width: 10%;
        }

        .wd-orders-table th:nth-child(2) {
            width: 20%;
        }

        .wd-orders-table th:nth-child(3) {
            width: 15%;
        }

        .wd-orders-table th:nth-child(4) {
            width: 20%;
        }

        .wd-orders-table th:nth-child(5) {
            width: 20%;
        }

        .wd-orders-table th:nth-child(6) {
            width: 15%;
        }

        /* جدول سلات التسوق */
        .wd-carts-table th:nth-child(1) {
            width: 15%;
        }

        .wd-carts-table th:nth-child(2) {
            width: 15%;
        }

        .wd-carts-table th:nth-child(3) {
            width: 15%;
        }

        .wd-carts-table th:nth-child(4) {
            width: 20%;
        }

        .wd-carts-table th:nth-child(5) {
            width: 20%;
        }

        .wd-carts-table th:nth-child(6) {
            width: 15%;
        }

        /* جدول الخصومات */
        .wd-discounts-table th:nth-child(1) {
            width: 8%;
        }

        .wd-discounts-table th:nth-child(2) {
            width: 18%;
        }

        .wd-discounts-table th:nth-child(3) {
            width: 12%;
        }

        .wd-discounts-table th:nth-child(4) {
            width: 12%;
        }

        .wd-discounts-table th:nth-child(5) {
            width: 18%;
        }

        .wd-discounts-table th:nth-child(6) {
            width: 15%;
        }

        .wd-discounts-table th:nth-child(7) {
            width: 17%;
        }

        .wd-discount-row {
            cursor: pointer;
        }

        .wd-discount-row:hover {
            background-color: #f8f9fa;
        }

        .wd-discount-details-row td {
            background-color: #f8f9fa;
        }

        .wd-discount-code {
            font-family: monospace;
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
            color: #333;
        }

        .wd-discount-type {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .wd-discount-type.percentage {
            background: #e3f2fd;
            color: #1565c0;
        }

        .wd-discount-type.fixed {
            background: #fff3cd;
            color: #856404;
        }

        .wd-discount-status {
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 500;
        }

        .wd-discount-status.active {
            background-color: #d4edda;
            color: #155724;
        }

        .wd-discount-status.expired {
            background-color: #f8d7da;
            color: #721c24;
        }

        .wd-discount-status.inactive {
            background-color: #e9ecef;
            color: #6c757d;
        }

        /* تحديد ينطبق على */
        .wd-discount-applies-to {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .wd-discount-products-select {
            display: none;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
            border: 1px dashed #ddd;
            border-radius: 6px;
            background: #fafafa;
            margin-top: 8px;
        }

        .wd-discount-products-select.visible {
            display: flex;
        }

        .wd-discount-products-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            max-height: 150px;
            overflow-y: auto;
            padding: 4px;
        }

        .wd-discount-product-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fff;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .wd-discount-product-item:hover {
            border-color: #25d366;
            background: #f0fff4;
        }

        .wd-discount-product-item.selected {
            border-color: #25d366;
            background: #d4edda;
        }

        .wd-discount-product-item input[type="checkbox"] {
            accent-color: #25d366;
        }

        .wd-selected-products-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 4px;
        }

        .wd-selected-product-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            background: #e3f2fd;
            color: #1565c0;
            border-radius: 999px;
            font-size: 11px;
        }

        .wd-selected-product-tag button {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 12px;
            padding: 0;
            line-height: 1;
        }

        /* المتطلبات الدنيا */
        .wd-discount-min-requirements {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .wd-discount-min-value-field {
            display: none;
            margin-top: 8px;
        }

        .wd-discount-min-value-field.visible {
            display: flex;
        }

        /* إعدادات المتجر */
        .wd-settings-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .wd-settings-section {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 16px;
        }

        .wd-settings-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .wd-settings-section-description {
            font-size: 13px;
            color: #666;
            margin-bottom: 16px;
        }

        .wd-settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .wd-settings-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .wd-settings-field label {
            font-size: 12px;
            color: #555;
            font-weight: 500;
        }

        .wd-settings-field input,
        .wd-settings-field select,
        .wd-settings-field textarea {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            transition: border-color 0.2s;
        }

        .wd-settings-field input:focus,
        .wd-settings-field select:focus,
        .wd-settings-field textarea:focus {
            outline: none;
            border-color: #25d366;
        }

        .wd-settings-field textarea {
            resize: vertical;
            min-height: 60px;
        }

        .wd-settings-checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .wd-settings-checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 6px;
            background: #fafafa;
        }

        .wd-settings-checkbox-item input[type="checkbox"] {
            margin-top: 2px;
            accent-color: #25d366;
        }

        .wd-settings-checkbox-content {
            flex: 1;
        }

        .wd-settings-checkbox-label {
            font-size: 13px;
            font-weight: 500;
            color: #333;
        }

        .wd-settings-checkbox-sub {
            display: none;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
        }

        .wd-settings-checkbox-sub.visible {
            display: block;
        }

        .wd-settings-save-btn {
            background: #25d366;
            color: #fff;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            align-self: flex-start;
        }

        .wd-settings-save-btn:hover {
            background: #1da851;
        }

        /* طرق الدفع المتعددة */
        .wd-payment-methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 8px;
        }

        .wd-payment-method-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fff;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
        }

        .wd-payment-method-item:hover {
            border-color: #25d366;
            background: #f0fff4;
        }

        .wd-payment-method-item:has(input:checked) {
            border-color: #25d366;
            background: #d4edda;
        }

        .wd-payment-method-item input[type="checkbox"] {
            accent-color: #25d366;
        }

        .wd-payment-method-item span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .wd-payment-method-item i {
            color: #666;
            width: 16px;
            text-align: center;
        }

        /* قسم المحفظة */
        .wd-wallet-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .wd-wallet-balance-card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
        }

        .wd-wallet-balance-grid {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 20px;
            align-items: center;
        }

        .wd-wallet-balance-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .wd-wallet-balance-label {
            font-size: 12px;
            font-weight: 500;
            color: #666;
        }

        .wd-wallet-balance-value {
            font-size: 28px;
            font-weight: 700;
            color: #25d366;
        }

        .wd-wallet-balance-value span {
            font-size: 14px;
            font-weight: 500;
            color: #666;
            margin-right: 2px;
        }

        .wd-wallet-balance-value.transfer-period {
            color: #333;
        }

        .wd-wallet-actions-item {
            display: flex;
            flex-direction: row;
            gap: 10px;
            align-items: center;
            justify-content: flex-end;
        }

        @media (max-width: 768px) {
            .wd-wallet-balance-grid {
                grid-template-columns: 1fr 1fr;
            }

            .wd-wallet-actions-item {
                grid-column: span 2;
                justify-content: center;
                margin-top: 10px;
            }
        }

        .wd-wallet-btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            border: none;
        }

        .wd-wallet-btn-add {
            background: #25d366;
            color: white;
        }

        .wd-wallet-btn-add:hover {
            background: #1da851;
        }

        .wd-wallet-btn-withdraw {
            background: #f0f0f0;
            color: #333;
            border: 1px solid #ddd;
        }

        .wd-wallet-btn-withdraw:hover {
            background: #e5e5e5;
        }

        .wd-wallet-section {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
        }

        .wd-wallet-section-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .wd-wallet-section-title {
            font-size: 15px;
            font-weight: 600;
            color: #333;
        }

        .wd-wallet-table {
            width: 100%;
            border-collapse: collapse;
        }

        .wd-wallet-table th {
            background: #f8f9fa;
            padding: 10px 12px;
            text-align: right;
            font-weight: 600;
            font-size: 12px;
            color: #555;
            border-bottom: 1px solid #eee;
        }

        .wd-wallet-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
            color: #333;
        }

        .wd-wallet-table tr:last-child td {
            border-bottom: none;
        }

        .wd-wallet-table tr:hover {
            background: #f8f9fa;
        }

        .wd-transaction-type {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 500;
        }

        .wd-transaction-type.deposit {
            background: #d4edda;
            color: #155724;
        }

        .wd-transaction-type.withdraw {
            background: #f8d7da;
            color: #721c24;
        }

        .wd-transaction-type.order {
            background: #e3f2fd;
            color: #1565c0;
        }

        .wd-transaction-amount {
            font-weight: 600;
        }

        .wd-transaction-amount.positive {
            color: #155724;
        }

        .wd-transaction-amount.negative {
            color: #721c24;
        }

        .wd-payment-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 500;
        }

        .wd-payment-status.success {
            background: #d4edda;
            color: #155724;
        }

        .wd-payment-status.failed {
            background: #f8d7da;
            color: #721c24;
        }

        .wd-payment-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .wd-billing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            padding: 16px;
        }

        .wd-billing-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .wd-billing-field label {
            font-size: 12px;
            color: #555;
            font-weight: 500;
        }

        .wd-billing-field input,
        .wd-billing-field select {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
        }

        .wd-billing-save-btn {
            margin: 0 16px 16px;
            background: #25d366;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
        }

        .wd-billing-save-btn:hover {
            background: #1da851;
        }

        /* Pagination المتقدم */
        .wd-pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-top: 1px solid #eee;
            background: #fafafa;
            flex-wrap: wrap;
            gap: 12px;
        }

        .wd-pagination-info {
            font-size: 13px;
            color: #666;
        }

        .wd-pagination-info strong {
            color: #333;
        }

        .wd-pagination-controls {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .wd-pagination-btn {
            min-width: 36px;
            height: 36px;
            padding: 0 10px;
            border: 1px solid #ddd;
            background: #fff;
            color: #333;
            font-size: 13px;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .wd-pagination-btn:hover:not(:disabled) {
            border-color: #25d366;
            color: #25d366;
        }

        .wd-pagination-btn.active {
            background: #25d366;
            border-color: #25d366;
            color: white;
        }

        .wd-pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .wd-pagination-btn.wd-pagination-nav {
            padding: 0 12px;
        }

        .wd-pagination-ellipsis {
            padding: 0 8px;
            color: #999;
            font-size: 14px;
        }

        .wd-pagination-per-page {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #666;
        }

        .wd-pagination-per-page select {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
        }

        .wd-pagination-jump {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #666;
        }

        .wd-pagination-jump input {
            width: 50px;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            text-align: center;
        }

        .wd-pagination-jump button {
            padding: 6px 12px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .wd-pagination-jump button:hover {
            background: #e5e5e5;
        }

        /* تخصيص الفواتير */
        .wd-invoice-customizer {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 1024px) {
            .wd-invoice-customizer {
                grid-template-columns: 1fr;
            }
        }

        .wd-invoice-fields {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .wd-invoice-field-group {
            background: #f8f9fa;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 14px;
        }

        .wd-invoice-field-group-title {
            font-size: 13px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .wd-invoice-checkbox-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .wd-invoice-checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #555;
            cursor: pointer;
        }

        .wd-invoice-checkbox-item input {
            accent-color: #25d366;
        }

        .wd-invoice-preview-container {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            position: sticky;
            top: 20px;
        }

        .wd-invoice-preview-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .wd-invoice-preview {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 20px;
            font-size: 11px;
            color: #333;
            overflow-y: auto;
        }

        .wd-invoice-header {
            text-align: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #25d366;
        }

        .wd-invoice-header h2 {
            font-size: 18px;
            color: #25d366;
            margin-bottom: 4px;
        }

        .wd-invoice-header p {
            font-size: 10px;
            color: #666;
        }

        .wd-invoice-store-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 12px;
            font-size: 10px;
        }

        .wd-invoice-store-info strong {
            display: block;
            margin-bottom: 4px;
            color: #333;
        }

        .wd-invoice-section {
            margin-bottom: 12px;
        }

        .wd-invoice-section-title {
            font-size: 11px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 1px dashed #ddd;
        }

        .wd-invoice-product {
            display: flex;
            gap: 10px;
            padding: 8px;
            background: #fafafa;
            border-radius: 4px;
            margin-bottom: 6px;
        }

        .wd-invoice-product-img {
            width: 40px;
            height: 40px;
            background: #e0e0e0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #999;
        }

        .wd-invoice-product-details {
            flex: 1;
        }

        .wd-invoice-product-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .wd-invoice-product-desc {
            font-size: 9px;
            color: #666;
            margin-bottom: 2px;
        }

        .wd-invoice-product-sku {
            font-size: 9px;
            color: #999;
        }

        .wd-invoice-product-price {
            text-align: left;
            font-weight: 600;
            color: #25d366;
        }

        .wd-invoice-totals {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 6px;
            margin-top: 12px;
        }

        .wd-invoice-total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 10px;
        }

        .wd-invoice-total-row.final {
            font-weight: 700;
            font-size: 12px;
            padding-top: 6px;
            border-top: 1px solid #ddd;
            margin-top: 6px;
        }

        .wd-invoice-barcode {
            text-align: center;
            margin: 12px 0;
            padding: 10px;
            background: #fafafa;
            border-radius: 4px;
        }

        .wd-invoice-barcode-img {
            height: 40px;
            background: repeating-linear-gradient(90deg, #333 0px, #333 2px, #fff 2px, #fff 4px);
            margin-bottom: 4px;
        }

        .wd-invoice-barcode-text {
            font-size: 9px;
            color: #666;
            font-family: monospace;
        }

        .wd-invoice-note {
            background: #fff3cd;
            padding: 8px;
            border-radius: 4px;
            font-size: 9px;
            color: #856404;
            margin-bottom: 8px;
        }

        .wd-invoice-policy {
            background: #e3f2fd;
            padding: 8px;
            border-radius: 4px;
            font-size: 9px;
            color: #1565c0;
            margin-bottom: 8px;
        }

        .wd-invoice-acknowledgment {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            font-size: 9px;
            color: #555;
            text-align: center;
            margin-bottom: 8px;
        }

        .wd-invoice-contact {
            text-align: center;
            font-size: 9px;
            color: #666;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
        }

        .wd-invoice-field-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            margin-bottom: 12px;
        }

        /* جدول المنتجات */
        .wd-products-table th:nth-child(1) {
            width: 10%;
        }

        .wd-products-table th:nth-child(2) {
            width: 10%;
        }

        .wd-products-table th:nth-child(3) {
            width: 15%;
        }

        .wd-products-table th:nth-child(4) {
            width: 15%;
        }

        .wd-products-table th:nth-child(5) {
            width: 15%;
        }

        .wd-products-table th:nth-child(6) {
            width: 15%;
        }

        .wd-products-table th:nth-child(7) {
            width: 15%;
        }

        .wd-product-image {
            display: flex;
            align-items: center;
        }

        .wd-product-image img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
            border: 1px solid #eee;
            background: #fafafa;
        }

        .wd-product-row {
            cursor: pointer;
        }

        .wd-product-row:hover {
            background-color: #f8f9fa;
        }

        .wd-product-details-row td {
            background-color: #f8f9fa;
        }

        .wd-product-details {
            padding: 12px 8px;
            border-top: 1px solid #e0e0e0;
        }

        .wd-product-section {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 12px 14px;
            margin-bottom: 10px;
            background-color: #fff;
        }

        .wd-product-main-grid {
            display: grid;
            grid-template-columns: minmax(0, 2fr) minmax(0, 1.2fr);
            gap: 16px;
            align-items: flex-start;
        }

        .wd-product-main-text {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .wd-product-main-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .wd-product-main-row .wd-product-details-field {
            flex: 1;
            min-width: 140px;
        }

        .wd-product-main-image {
            align-self: stretch;
            display: flex;
            flex-direction: column;
        }

        .wd-product-main-image label {
            display: block;
            margin-bottom: 6px;
        }

        .wd-product-image-upload {
            position: relative;
            border: 1px dashed #ccc;
            border-radius: 8px;
            padding: 18px 12px;
            text-align: center;
            color: #777;
            background-color: #fafafa;
            cursor: pointer;
            font-size: 13px;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .wd-product-image-upload input[type="file"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }

        .wd-product-image-preview {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
            border-radius: 6px;
            display: none;
        }

        .wd-product-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        .wd-product-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px 15px;
        }

        .wd-product-details-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .wd-product-details-field label {
            font-size: 12px;
            color: #666;
        }

        .wd-product-details-field input,
        .wd-product-details-field select {
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 13px;
        }

        /* حقل قيم الخيار يجب أن يظهر كحقل واحد فقط */
        .wd-product-details-field .wd-product-option-value-input-field {
            border: none;
            padding: 2px 0;
            background: transparent;
        }

        .wd-product-details-field textarea {
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 13px;
            resize: vertical;
            min-height: 70px;
        }

        .wd-switch-inline {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #555;
        }

        /* خيارات المنتج (التباينات) */
        .wd-product-variants-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .wd-product-variants-options {
            border: 1px dashed #eee;
            border-radius: 6px;
            padding: 8px 10px;
            background-color: #fafafa;
            min-height: 40px;
        }

        .wd-product-variants-empty {
            font-size: 12px;
            color: #999;
        }

        .wd-product-option {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .wd-product-option-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .wd-product-option-row .wd-product-details-field {
            flex: 1;
            min-width: 160px;
        }

        .wd-product-option-value-input {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            align-items: center;
            padding: 4px 6px;
            border-radius: 6px;
            border: 1px solid #ddd;
            min-height: 32px;
            background-color: #fff;
            cursor: text;
        }

        .wd-product-option-value-input-field {
            border: none;
            outline: none;
            flex: 1;
            min-width: 120px;
            font-size: 12px;
            padding: 2px 0;
            background: transparent;
        }

        .wd-product-option-value-tag {
            background-color: #e3f2fd;
            color: #1565c0;
            border-radius: 999px;
            padding: 2px 6px;
            font-size: 11px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            max-width: 100%;
            white-space: nowrap;
        }

        .wd-product-option-value-remove {
            border: none;
            background: #ffe5e9;
            color: #dc3545;
            cursor: pointer;
            padding: 0 6px;
            font-size: 11px;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .wd-product-option-remove {
            border: none;
            background: #ffe5e9;
            color: #dc3545;
            cursor: pointer;
            padding: 0 10px;
            font-size: 12px;
            border-radius: 6px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .wd-variants-table-wrapper {
            margin-top: 10px;
        }

        .wd-product-variants-subtitle {
            font-size: 11px;
            color: #888;
        }

        .wd-variants-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            background-color: #fff;
        }

        .wd-variants-table th,
        .wd-variants-table td {
            border: 1px solid #eee;
            padding: 4px 6px;
            text-align: right;
        }

        .wd-variants-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        .wd-variants-table input {
            width: 100%;
            padding: 3px 6px;
            font-size: 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        @media (max-width: 768px) {
            .wd-product-main-grid {
                grid-template-columns: 1fr;
            }
        }

        .wd-product-details-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-start;
        }

        .wd-btn-secondary {
            background-color: #f0f0f0;
            color: #333;
            border: none;
            padding: 2px 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }

        .wd-btn-danger {
            background-color: #dc3545;
            color: #fff;
            border: none;
            padding: 6px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }

        @media (max-width: 768px) {
            .wd-search-container {
                flex-direction: column;
            }

            .wd-filter-options {
                flex-direction: column;
            }

            .wd-filter-select {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <div class="wd-container">
        <!-- القسم الأول: القائمة الجانبية -->
        <aside class="wd-sidebar">
            <div class="wd-logo">
                <img src="../imgs/logo.png" alt="شعار المنصة" />
            </div>
            <nav class="wd-nav">
                <ul>
                    <li class="wd-nav-item">
                        <i class="fa-solid fa-gauge"></i>
                        <span><a href="../index.html" class="wd-nav-link">لوحة التحكم</a></span>
                    </li>
                    <li class="wd-nav-item">
                        <i class="fa-solid fa-comments"></i>
                        <span><a href="../chat.html" class="wd-nav-link">المحادثات</a></span>
                    </li>
                    <li class="wd-nav-item">
                        <i class="fa-solid fa-users"></i>
                        <span><a href="../contacts.html" class="wd-nav-link">جهات الاتصال</a></span>
                    </li>
                    <li class="wd-nav-item">
                        <i class="fa-solid fa-diagram-project"></i>
                        <span><a href="../flows.html" class="wd-nav-link">التدفقات</a></span>
                    </li>
                    <li class="wd-nav-item">
                        <i class="fas fa-bullhorn"></i>
                        <span><a href="../campaigns.html" class="wd-nav-link">الحملات</a></span>
                    </li>
                    <li class="wd-nav-item">
                        <i class="fas fa-calendar"></i>
                        <span><a href="../calendar.html" class="wd-nav-link">التقويم</a></span>
                    </li>
                    <li class="wd-nav-item active">
                        <i class="fas fa-file-alt"></i>
                        <span><a href="../contents.html" class="wd-nav-link">المحتويات</a></span>
                    </li>
                    <li class="wd-nav-item">
                        <i class="fas fa-code"></i>
                        <span><a href="../developers.html" class="wd-nav-link">المطورين</a></span>
                    </li>
                    <li class="wd-nav-item">
                        <i class="fas fa-cog"></i>
                        <span><a href="../settings.html" class="wd-nav-link">الإعدادات</a></span>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- القسم الثاني: القائمة الجانبية الثانية -->
        <div class="wd-secondary-sidebar">
            <div class="wd-account-switcher">
                <div class="wd-account-info">
                    <img src="../imgs/logo.png" alt="صورة الحساب" class="wd-account-avatar" />
                    <div class="wd-account-details">
                        <span class="wd-account-name">حساب الشركة</span>
                        <span class="wd-account-type">مدير</span>
                    </div>
                </div>
                <button class="wd-account-switch">
                    <i class="fas fa-exchange-alt"></i>
                </button>
            </div>
            <div class="wd-secondary-content">
                <nav class="wd-secondary-nav">
                    <ul>
                        <a href="../contents.html" class="wd-nav-link">
                            <li class="wd-secondary-nav-item">
                                <i class="fas fa-user-cog"></i>
                                <span>متغيرات المستخدم</span>
                            </li>
                        </a>
                        <a href="../contents/system.html" class="wd-nav-link">
                            <li class="wd-secondary-nav-item">
                                <i class="fas fa-cogs"></i>
                                <span>متغيرات النظام</span>
                            </li>
                        </a>
                        <a href="../contents/store.html" class="wd-nav-link">
                            <li class="wd-secondary-nav-item active">
                                <i class="fas fa-store"></i>
                                <span>المتجر</span>
                            </li>
                        </a>
                        <a href="../contents/sku.html" class="wd-nav-link">
                            <li class="wd-secondary-nav-item">
                                <i class="fas fa-hashtag"></i>
                                <span>إعداد SKU</span>
                            </li>
                        </a>
                        <a href="../contents/automation.html" class="wd-nav-link">
                            <li class="wd-secondary-nav-item">
                                <i class="fas fa-robot"></i>
                                <span>الرد الآلي</span>
                            </li>
                        </a>
                        <a href="../contents/journies.html" class="wd-nav-link">
                            <li class="wd-secondary-nav-item">
                                <i class="fas fa-calendar"></i>
                                <span>رحلة العميل</span>
                            </li>
                        </a>
                        <a href="../contents/tags.html" class="wd-nav-link">
                            <li class="wd-secondary-nav-item">
                                <i class="fas fa-tags"></i>
                                <span>الوسوم</span>
                            </li>
                        </a>
                        <a href="../contents/shortcuts.html" class="wd-nav-link">
                            <li class="wd-secondary-nav-item">
                                <i class="fas fa-keyboard"></i>
                                <span>الاختصارات</span>
                            </li>
                        </a>
                        <a href="../contents/whatsapp.html" class="wd-nav-link">
                            <li class="wd-secondary-nav-item">
                                <i class="fab fa-whatsapp"></i>
                                <span>قوالب الواتساب</span>
                            </li>
                        </a>
                        <a href="../contents/email.html" class="wd-nav-link">
                            <li class="wd-secondary-nav-item">
                                <i class="fas fa-envelope"></i>
                                <span>البريد الكتروني
                                    <span class="wd-coming-soon">قريباً</span></span>
                            </li>
                        </a>
                        <a href="../contents/sms.html" class="wd-nav-link">
                            <li class="wd-secondary-nav-item">
                                <i class="fas fa-comment-dots"></i>
                                <span>الرسائل النصية
                                    <span class="wd-coming-soon">قريباً</span></span>
                            </li>
                        </a>
                    </ul>
                </nav>
            </div>
        </div>

        <!-- القسم الثالث: المحتوى الرئيسي -->
        <div class="wd-main-content">
            <div class="wd-content-header">
                <div class="wd-header-left">
                    <button class="wd-toggle-secondary" onclick="toggleSecondarySidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>المتجر</h1>
                </div>
                <div class="wd-header-actions">
                    <a class="wd-btn" id="storeActionBtn" style="display: none">
                        <i class="fas fa-plus"></i>
                        إضافة منتج
                    </a>
                </div>
            </div>

            <div class="wd-content-body">
                <!-- شريط التبويبات -->
                <div class="wd-tabs">
                    <button class="wd-tab wd-tab-active" data-tab="orders">الطلبات</button>
                    <button class="wd-tab" data-tab="products">المنتجات</button>
                    <button class="wd-tab" data-tab="carts">سلات التسوق</button>
                    <button class="wd-tab" data-tab="discounts">الخصومات</button>
                    <button class="wd-tab" data-tab="wallet">المحفظة</button>
                    <button class="wd-tab" data-tab="settings">الإعدادات</button>
                </div>

                <!-- تبويب الطلبات -->
                <div class="wd-tab-content wd-tab-content-active" data-tab-content="orders">
                    <div class="wd-table-container">
                        <table class="wd-table wd-orders-table">
                            <thead>
                                <tr>
                                    <th>رقم الطلب</th>
                                    <th>تاريخ الطلب</th>
                                    <th>الحالة</th>
                                    <th>العميل</th>
                                    <th>المنتج</th>
                                    <th>الإجمالي</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <tr>
                                    <td>#1001</td>
                                    <td>01/01/2025 10:30</td>
                                    <td>
                                        <select class="wd-order-status option-completed">
                                            <option value="new">جديد</option>
                                            <option value="processing">قيد المعالجة</option>
                                            <option value="completed" selected>مكتمل</option>
                                            <option value="cancelled">ملغي</option>
                                        </select>
                                    </td>
                                    <td>عميل افتراضي</td>
                                    <td>منتج تجريبي</td>
                                    <td>150.00 ر.س</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- تبويب المنتجات -->
                <div class="wd-tab-content" data-tab-content="products">
                    <div class="wd-table-container">
                        <table class="wd-table wd-products-table">
                            <thead>
                                <tr>
                                    <th>التفاصيل</th>
                                    <th>الصورة</th>
                                    <th>الاسم</th>
                                    <th>الشحن</th>
                                    <th>السعر</th>
                                    <th>الكمية</th>
                                    <th>الحالة</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- تبويب سلات التسوق -->
                <div class="wd-tab-content" data-tab-content="carts">
                    <div class="wd-table-container">
                        <table class="wd-table wd-carts-table">
                            <thead>
                                <tr>
                                    <th>تاريخ الإنشاء</th>
                                    <th>تاريخ التحديث</th>
                                    <th>القناة</th>
                                    <th>العميل</th>
                                    <th>المنتج</th>
                                    <th>الإجمالي</th>
                                </tr>
                            </thead>
                            <tbody id="cartsTableBody">
                                <tr>
                                    <td>01/02/2025 09:15</td>
                                    <td>01/02/2025 10:30</td>
                                    <td><i class="fab fa-whatsapp" style="color: #25d366;"></i> واتساب</td>
                                    <td>أحمد محمد</td>
                                    <td>منتج تجريبي</td>
                                    <td>250.00 ر.س</td>
                                </tr>
                                <tr>
                                    <td>31/01/2025 14:20</td>
                                    <td>31/01/2025 14:45</td>
                                    <td><i class="fas fa-globe" style="color: #1877f2;"></i> الموقع</td>
                                    <td>سارة أحمد</td>
                                    <td>منتج آخر</td>
                                    <td>180.00 ر.س</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- تبويب الخصومات -->
                <div class="wd-tab-content" data-tab-content="discounts">
                    <div class="wd-table-container">
                        <table class="wd-table wd-discounts-table">
                            <thead>
                                <tr>
                                    <th>التفاصيل</th>
                                    <th>رمز الخصم</th>
                                    <th>النوع</th>
                                    <th>القيمة</th>
                                    <th>تاريخ الانتهاء</th>
                                    <th>الاستخدامات</th>
                                    <th>الحالة</th>
                                </tr>
                            </thead>
                            <tbody id="discountsTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- تبويب المحفظة -->
                <div class="wd-tab-content" data-tab-content="wallet">
                    <div class="wd-wallet-container">
                        <!-- رصيد المتجر -->
                        <div class="wd-wallet-balance-card">
                            <div class="wd-wallet-balance-grid">
                                <div class="wd-wallet-balance-item">
                                    <div class="wd-wallet-balance-label">رصيد المتجر الحالي</div>
                                    <div class="wd-wallet-balance-value">
                                        12,500.00 <span>ر.س</span>
                                    </div>
                                </div>
                                <div class="wd-wallet-balance-item">
                                    <div class="wd-wallet-balance-label">مدة تحويل الأرباح</div>
                                    <div class="wd-wallet-balance-value transfer-period">
                                        7 <span>أيام</span>
                                    </div>
                                </div>
                                <div class="wd-wallet-balance-item wd-wallet-actions-item">
                                    <button class="wd-wallet-btn wd-wallet-btn-add" onclick="showAddBalanceModal()">
                                        <i class="fas fa-plus"></i> إضافة رصيد
                                    </button>
                                    <button class="wd-wallet-btn wd-wallet-btn-withdraw" onclick="showWithdrawModal()">
                                        <i class="fas fa-minus"></i> سحب رصيد
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- سجل العمليات -->
                        <div class="wd-wallet-section">
                            <div class="wd-wallet-section-header">
                                <div class="wd-wallet-section-title">سجل العمليات</div>
                            </div>
                            <table class="wd-wallet-table" id="transactionsTable">
                                <thead>
                                    <tr>
                                        <th>التاريخ</th>
                                        <th>نوع العملية</th>
                                        <th>الوصف</th>
                                        <th>المبلغ</th>
                                        <th>الرصيد بعد العملية</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsTableBody"></tbody>
                            </table>
                            <div class="wd-pagination-container" id="transactionsPagination"></div>
                        </div>

                        <!-- سجلات الدفع بالمتجر -->
                        <div class="wd-wallet-section">
                            <div class="wd-wallet-section-header">
                                <div class="wd-wallet-section-title">سجلات الدفع بالمتجر</div>
                            </div>
                            <table class="wd-wallet-table" id="paymentLogsTable">
                                <thead>
                                    <tr>
                                        <th>رقم الطلب</th>
                                        <th>التاريخ</th>
                                        <th>العميل</th>
                                        <th>طريقة الدفع</th>
                                        <th>المبلغ</th>
                                        <th>الحالة</th>
                                    </tr>
                                </thead>
                                <tbody id="paymentLogsTableBody"></tbody>
                            </table>
                            <div class="wd-pagination-container" id="paymentLogsPagination"></div>
                        </div>
                    </div>
                </div>

                <!-- تبويب الإعدادات -->
                <div class="wd-tab-content" data-tab-content="settings">
                    <div class="wd-settings-container">
                        <!-- تفاصيل المتجر -->
                        <div class="wd-settings-section">
                            <div class="wd-settings-section-title">تفاصيل المتجر</div>
                            <div class="wd-settings-section-description">سيستخدم عملاء متجرك هذه المعلومات للاتصال بك.
                            </div>
                            <div class="wd-settings-grid">
                                <div class="wd-settings-field">
                                    <label>اسم المتجر</label>
                                    <input type="text" id="storeName" placeholder="أدخل اسم المتجر" />
                                </div>
                                <div class="wd-settings-field">
                                    <label>بريد الاتصال بالمتجر</label>
                                    <input type="email" id="storeEmail" placeholder="example@store.com" />
                                </div>
                                <div class="wd-settings-field">
                                    <label>هاتف الاتصال بالمتجر</label>
                                    <input type="tel" id="storePhone" placeholder="+966 5XXXXXXXX" />
                                </div>
                                <div class="wd-settings-field">
                                    <label>فئة المتجر</label>
                                    <select id="storeCategory">
                                        <option value="">اختر الفئة</option>
                                        <option value="fashion">أزياء وملابس</option>
                                        <option value="electronics">إلكترونيات</option>
                                        <option value="food">أغذية ومشروبات</option>
                                        <option value="health">صحة وجمال</option>
                                        <option value="home">منزل وحديقة</option>
                                        <option value="sports">رياضة ولياقة</option>
                                        <option value="toys">ألعاب وهدايا</option>
                                        <option value="books">كتب وقرطاسية</option>
                                        <option value="other">أخرى</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- عنوان المتجر -->
                        <div class="wd-settings-section">
                            <div class="wd-settings-section-title">عنوان المتجر</div>
                            <div class="wd-settings-section-description">سيظهر هذا العنوان على فواتير العملاء.</div>
                            <div class="wd-settings-grid">
                                <div class="wd-settings-field">
                                    <label>الاسم القانوني للعمل</label>
                                    <input type="text" id="legalName" placeholder="الاسم القانوني" />
                                </div>
                                <div class="wd-settings-field" style="grid-column: span 2;">
                                    <label>العنوان</label>
                                    <textarea id="storeAddress" placeholder="العنوان التفصيلي"></textarea>
                                </div>
                                <div class="wd-settings-field">
                                    <label>البلد</label>
                                    <select id="storeCountry">
                                        <option value="">اختر البلد</option>
                                        <option value="SA">المملكة العربية السعودية</option>
                                        <option value="AE">الإمارات العربية المتحدة</option>
                                        <option value="KW">الكويت</option>
                                        <option value="BH">البحرين</option>
                                        <option value="QA">قطر</option>
                                        <option value="OM">عُمان</option>
                                        <option value="EG">مصر</option>
                                        <option value="JO">الأردن</option>
                                        <option value="LB">لبنان</option>
                                        <option value="IQ">العراق</option>
                                        <option value="SY">سوريا</option>
                                        <option value="PS">فلسطين</option>
                                        <option value="YE">اليمن</option>
                                        <option value="LY">ليبيا</option>
                                        <option value="TN">تونس</option>
                                        <option value="DZ">الجزائر</option>
                                        <option value="MA">المغرب</option>
                                        <option value="SD">السودان</option>
                                        <option value="MR">موريتانيا</option>
                                        <option value="SO">الصومال</option>
                                        <option value="DJ">جيبوتي</option>
                                        <option value="KM">جزر القمر</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- طريقة الشحن -->
                        <div class="wd-settings-section">
                            <div class="wd-settings-section-title">طريقة الشحن</div>
                            <div class="wd-settings-section-description">طريقة الشحن التي يمكن للعميل اختيارها. سيتم
                                استخدام عنوان المتجر كعنوان للاستلام.</div>
                            <div class="wd-settings-checkbox-group">
                                <div class="wd-settings-checkbox-item">
                                    <input type="checkbox" id="pickupOption" />
                                    <div class="wd-settings-checkbox-content">
                                        <div class="wd-settings-checkbox-label">الالتقاط من عنوان المتجر</div>
                                    </div>
                                </div>
                                <div class="wd-settings-checkbox-item">
                                    <input type="checkbox" id="deliveryOption" />
                                    <div class="wd-settings-checkbox-content">
                                        <div class="wd-settings-checkbox-label">توصيل</div>
                                        <div class="wd-settings-checkbox-sub" id="deliverySettings">
                                            <div class="wd-settings-grid">
                                                <div class="wd-settings-field">
                                                    <label>شركة الشحن</label>
                                                    <select id="shippingCompany">
                                                        <option value="">اختر شركة الشحن</option>
                                                        <option value="aramex">أرامكس</option>
                                                        <option value="smsa">سمسا</option>
                                                        <option value="dhl">DHL</option>
                                                        <option value="fedex">فيديكس</option>
                                                        <option value="ups">UPS</option>
                                                        <option value="other">أخرى</option>
                                                    </select>
                                                </div>
                                                <div class="wd-settings-field">
                                                    <label>رسوم التوصيل (ر.س)</label>
                                                    <input type="number" id="deliveryFee" step="0.01"
                                                        placeholder="0.00" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- طريقة الدفع -->
                        <div class="wd-settings-section">
                            <div class="wd-settings-section-title">طريقة الدفع</div>
                            <div class="wd-settings-section-description">طرق الدفع التي تم تمكينها في صفحة الخروج.</div>
                            <div class="wd-settings-field" style="margin-bottom: 12px;">
                                <label style="margin-bottom: 8px; display: block;">طرق الدفع المتاحة</label>
                                <div class="wd-payment-methods-grid">
                                    <label class="wd-payment-method-item">
                                        <input type="checkbox" name="paymentMethod" value="cod" />
                                        <span><i class="fas fa-money-bill-wave"></i> الدفع عند الاستلام</span>
                                    </label>
                                    <label class="wd-payment-method-item">
                                        <input type="checkbox" name="paymentMethod" value="bank" />
                                        <span><i class="fas fa-university"></i> تحويل بنكي</span>
                                    </label>
                                    <label class="wd-payment-method-item">
                                        <input type="checkbox" name="paymentMethod" value="card" />
                                        <span><i class="fas fa-credit-card"></i> بطاقة ائتمان</span>
                                    </label>
                                    <label class="wd-payment-method-item">
                                        <input type="checkbox" name="paymentMethod" value="mada" />
                                        <span><i class="fas fa-credit-card"></i> مدى</span>
                                    </label>
                                    <label class="wd-payment-method-item">
                                        <input type="checkbox" name="paymentMethod" value="apple" />
                                        <span><i class="fab fa-apple-pay"></i> Apple Pay</span>
                                    </label>
                                    <label class="wd-payment-method-item">
                                        <input type="checkbox" name="paymentMethod" value="stc" />
                                        <span><i class="fas fa-mobile-alt"></i> STC Pay</span>
                                    </label>
                                    <label class="wd-payment-method-item">
                                        <input type="checkbox" name="paymentMethod" value="tabby" />
                                        <span><i class="fas fa-clock"></i> تابي</span>
                                    </label>
                                    <label class="wd-payment-method-item">
                                        <input type="checkbox" name="paymentMethod" value="tamara" />
                                        <span><i class="fas fa-clock"></i> تمارا</span>
                                    </label>
                                </div>
                            </div>
                            <div class="wd-settings-grid">
                                <div class="wd-settings-field">
                                    <label>العملة</label>
                                    <select id="currency">
                                        <option value="SAR">ريال سعودي (SAR)</option>
                                        <option value="AED">درهم إماراتي (AED)</option>
                                        <option value="KWD">دينار كويتي (KWD)</option>
                                        <option value="BHD">دينار بحريني (BHD)</option>
                                        <option value="QAR">ريال قطري (QAR)</option>
                                        <option value="OMR">ريال عماني (OMR)</option>
                                        <option value="EGP">جنيه مصري (EGP)</option>
                                        <option value="JOD">دينار أردني (JOD)</option>
                                        <option value="USD">دولار أمريكي (USD)</option>
                                    </select>
                                </div>
                                <div class="wd-settings-field">
                                    <label>نسبة الضريبة (%)</label>
                                    <input type="number" id="taxRate" step="0.01" placeholder="15" />
                                </div>
                            </div>
                        </div>

                        <!-- زر الحفظ -->
                        <button type="button" class="wd-settings-save-btn" onclick="saveStoreSettings()">
                            <i class="fas fa-save"></i> حفظ الإعدادات
                        </button>

                        <!-- تخصيص الفواتير -->
                        <div class="wd-settings-section" style="margin-top: 20px;">
                            <div class="wd-settings-section-title">تخصيص الفواتير</div>
                            <div class="wd-settings-section-description">قم بتخصيص شكل ومحتوى الفاتورة المرسلة للعملاء.
                            </div>

                            <div class="wd-invoice-customizer">
                                <!-- حقول التخصيص -->
                                <div class="wd-invoice-fields">
                                    <!-- عنوان الفاتورة -->
                                    <div class="wd-invoice-field-group">
                                        <div class="wd-invoice-field-group-title">محتوى الفاتورة</div>
                                        <label
                                            style="font-size: 12px; color: #666; margin-bottom: 6px; display: block;">عنوان
                                            الفاتورة</label>
                                        <input type="text" class="wd-invoice-field-input" id="invoiceTitle"
                                            value="فاتورة ضريبية" oninput="updateInvoicePreview()" />
                                    </div>

                                    <!-- معلومات المنتج -->
                                    <div class="wd-invoice-field-group">
                                        <div class="wd-invoice-field-group-title">معلومات المنتج</div>
                                        <div class="wd-invoice-checkbox-list">
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="showProductImage" checked
                                                    onchange="updateInvoicePreview()" />
                                                <span>إظهار صورة المنتج</span>
                                            </label>
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="showProductDesc" checked
                                                    onchange="updateInvoicePreview()" />
                                                <span>إظهار وصف المنتجات</span>
                                            </label>
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="showProductSKU"
                                                    onchange="updateInvoicePreview()" />
                                                <span>إظهار الرقم المخزني للمنتج (SKU)</span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- معلومات الطلب والفاتورة -->
                                    <div class="wd-invoice-field-group">
                                        <div class="wd-invoice-field-group-title">معلومات الطلب والفاتورة</div>
                                        <div class="wd-invoice-checkbox-list">
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="showBarcode" checked
                                                    onchange="updateInvoicePreview()" />
                                                <span>إظهار باركود الفاتورة</span>
                                            </label>
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="showEnglishVersion"
                                                    onchange="updateInvoicePreview()" />
                                                <span>إصدار نسخة من الفاتورة باللغة الإنجليزية</span>
                                            </label>
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="showAcknowledgment" checked
                                                    onchange="updateInvoicePreview()" />
                                                <span>إظهار الإقرار بالفاتورة / ملخص الطلب</span>
                                            </label>
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="showOrderNote"
                                                    onchange="updateInvoicePreview()" />
                                                <span>إظهار ملاحظة الطلب</span>
                                            </label>
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="showReturnPolicy" checked
                                                    onchange="updateInvoicePreview()" />
                                                <span>إظهار سياسة الاستبدال والاسترجاع</span>
                                            </label>
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="autoSendInvoice" checked
                                                    onchange="updateInvoicePreview()" />
                                                <span>إرسال الفاتورة / تفاصيل الطلب تلقائياً</span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- حالات الطلب لإرسال الفاتورة -->
                                    <div class="wd-invoice-field-group">
                                        <div class="wd-invoice-field-group-title">متى تُرسل الفاتورة (حالات الطلب)</div>
                                        <div class="wd-invoice-checkbox-list">
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="sendOnNew" checked
                                                    onchange="updateInvoicePreview()" />
                                                <span>عند إنشاء الطلب (جديد)</span>
                                            </label>
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="sendOnProcessing"
                                                    onchange="updateInvoicePreview()" />
                                                <span>عند معالجة الطلب</span>
                                            </label>
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="sendOnShipped" checked
                                                    onchange="updateInvoicePreview()" />
                                                <span>عند شحن الطلب</span>
                                            </label>
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="sendOnDelivered"
                                                    onchange="updateInvoicePreview()" />
                                                <span>عند تسليم الطلب</span>
                                            </label>
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="sendOnCompleted"
                                                    onchange="updateInvoicePreview()" />
                                                <span>عند اكتمال الطلب</span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- معلومات المتجر والتواصل -->
                                    <div class="wd-invoice-field-group">
                                        <div class="wd-invoice-field-group-title">معلومات المتجر والتواصل</div>
                                        <div class="wd-invoice-checkbox-list">
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="showStoreAddress" checked
                                                    onchange="updateInvoicePreview()" />
                                                <span>إظهار عنوان المتجر</span>
                                            </label>
                                            <label class="wd-invoice-checkbox-item">
                                                <input type="checkbox" id="showContactInfo" checked
                                                    onchange="updateInvoicePreview()" />
                                                <span>إظهار بيانات التواصل</span>
                                            </label>
                                        </div>
                                    </div>

                                    <button type="button" class="wd-settings-save-btn" onclick="saveInvoiceSettings()">
                                        <i class="fas fa-save"></i> حفظ إعدادات الفاتورة
                                    </button>
                                </div>

                                <!-- معاينة الفاتورة -->
                                <div class="wd-invoice-preview-container">
                                    <div class="wd-invoice-preview-title">
                                        <i class="fas fa-eye"></i> معاينة الفاتورة
                                    </div>
                                    <div class="wd-invoice-preview" id="invoicePreview">
                                        <!-- سيتم تحديثها بواسطة JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // تبديل تبويبات المتجر + زر الإجراء لتبويبي المنتجات والخصومات فقط
        document.addEventListener("DOMContentLoaded", function () {
            const tabs = document.querySelectorAll(".wd-tab");
            const contents = document.querySelectorAll("[data-tab-content]");
            const actionBtn = document.getElementById("storeActionBtn");

            // تلوين حالة الطلب حسب القيمة
            function updateOrderStatusStyles() {
                const selects = document.querySelectorAll(".wd-order-status");
                selects.forEach((sel) => {
                    sel.classList.remove(
                        "option-new",
                        "option-processing",
                        "option-completed",
                        "option-cancelled"
                    );
                    switch (sel.value) {
                        case "new":
                            sel.classList.add("option-new");
                            break;
                        case "processing":
                            sel.classList.add("option-processing");
                            break;
                        case "completed":
                            sel.classList.add("option-completed");
                            break;
                        case "cancelled":
                            sel.classList.add("option-cancelled");
                            break;
                    }
                });
            }

            // تهيئة مستمعات التغيير لحالات الطلب
            document
                .querySelectorAll(".wd-order-status")
                .forEach((sel) => sel.addEventListener("change", updateOrderStatusStyles));

            updateOrderStatusStyles();

            function setupProductRow(mainRow) {
                const detailsRow = mainRow.nextElementSibling;
                if (!detailsRow) return;

                const nameCell = mainRow.querySelector(".wd-product-name");
                const shippingCell = mainRow.querySelector(".wd-product-shipping");
                const priceCell = mainRow.querySelector(".wd-product-price");
                const qtyCell = mainRow.querySelector(".wd-product-qty");
                const statusCell = mainRow.querySelector(".wd-product-status");
                const imgEl = mainRow.querySelector(".wd-product-image img");

                const imageInput = detailsRow.querySelector(".wd-product-input-image");
                const nameInput = detailsRow.querySelector(".wd-product-input-name");
                const shippingInput =
                    detailsRow.querySelector(".wd-product-input-shipping");
                const descriptionInput =
                    detailsRow.querySelector(".wd-product-input-description");
                const priceInput = detailsRow.querySelector(".wd-product-input-price");
                const qtyInput = detailsRow.querySelector(".wd-product-input-qty");
                const statusInput =
                    detailsRow.querySelector(".wd-product-input-status");
                const variantsOptionsContainer = detailsRow.querySelector(
                    ".wd-product-variants-options"
                );
                const variantsTableWrapper = detailsRow.querySelector(
                    ".wd-variants-table-wrapper"
                );
                const variantsTableBody = detailsRow.querySelector(
                    ".wd-variants-table tbody"
                );
                const addOptionBtn = detailsRow.querySelector(
                    ".wd-product-add-option"
                );

                const saveBtn = detailsRow.querySelector(".wd-product-save");
                const deleteBtn = detailsRow.querySelector(".wd-product-delete");
                const cancelBtn = detailsRow.querySelector(".wd-product-cancel");
                const shippingIncludedCheckbox = detailsRow.querySelector(
                    ".wd-product-input-shipping-included"
                );
                const shippingCostField = detailsRow.querySelector(
                    ".wd-shipping-cost-field"
                );
                const shippingCostInput = detailsRow.querySelector(
                    ".wd-product-input-shipping-cost"
                );

                // إدارة إظهار/إخفاء حقل سعر الشحن
                if (shippingIncludedCheckbox && shippingCostField) {
                    function toggleShippingCostField() {
                        if (shippingIncludedCheckbox.checked) {
                            shippingCostField.style.display = "none";
                            if (shippingCostInput) {
                                shippingCostInput.value = "";
                            }
                        } else {
                            shippingCostField.style.display = "flex";
                        }
                    }

                    shippingIncludedCheckbox.addEventListener("change", toggleShippingCostField);
                    // تهيئة الحالة الأولية
                    toggleShippingCostField();
                }

                function fillDetailsFromMain() {
                    nameInput.value = nameCell.textContent.trim();
                    if (shippingInput && shippingCell) {
                        shippingInput.value = shippingCell.textContent.trim();
                    }
                    if (descriptionInput) {
                        descriptionInput.value = "";
                    }
                    priceInput.value = priceCell.textContent.trim();
                    qtyInput.value = qtyCell.textContent.trim();
                    statusInput.value = statusCell.textContent.trim() || "متوفر";
                    // إعادة تعيين checkbox سعر الشحن
                    if (shippingIncludedCheckbox) {
                        shippingIncludedCheckbox.checked = false;
                        if (shippingCostField) {
                            shippingCostField.style.display = "none";
                        }
                        if (shippingCostInput) {
                            shippingCostInput.value = "";
                        }
                    }
                }

                if (imageInput && imgEl) {
                    const uploadWrapper = detailsRow.querySelector(
                        ".wd-product-image-upload"
                    );
                    const previewImg = uploadWrapper
                        ? uploadWrapper.querySelector(".wd-product-image-preview")
                        : null;
                    const placeholderSpan = uploadWrapper
                        ? uploadWrapper.querySelector(".wd-product-image-placeholder")
                        : null;

                    imageInput.addEventListener("change", function () {
                        const file = this.files && this.files[0];
                        if (!file) return;

                        const reader = new FileReader();
                        reader.onload = function (e) {
                            if (e.target && typeof e.target.result === "string") {
                                const src = e.target.result;
                                imgEl.src = src;
                                imgEl.setAttribute("data-image-src", src);

                                if (previewImg) {
                                    previewImg.src = src;
                                    previewImg.style.display = "block";
                                }
                                if (placeholderSpan) {
                                    placeholderSpan.style.display = "none";
                                }
                            }
                        };
                        reader.readAsDataURL(file);
                    });
                }

                function setupVariants() {
                    if (detailsRow.dataset.variantsInitialized === "1") {
                        return;
                    }
                    if (!variantsOptionsContainer || !variantsTableBody || !addOptionBtn) {
                        return;
                    }

                    const emptyPlaceholder = variantsOptionsContainer.querySelector(
                        ".wd-product-variants-empty"
                    );

                    function collectOptions() {
                        const optionEls = variantsOptionsContainer.querySelectorAll(
                            ".wd-product-option"
                        );
                        const options = [];

                        optionEls.forEach((optEl) => {
                            const nameInput = optEl.querySelector(
                                ".wd-product-option-name"
                            );
                            const valueTags = optEl.querySelectorAll(
                                ".wd-product-option-value-tag span"
                            );
                            const name = nameInput ? nameInput.value.trim() : "";
                            const values = Array.from(valueTags)
                                .map((span) => span.textContent.trim())
                                .filter((v) => v);

                            if (values.length > 0) {
                                options.push({ name, values });
                            }
                        });

                        return options;
                    }

                    function buildCombinations(options) {
                        if (!options.length) return [];

                        let result = [[]];
                        options.forEach((opt) => {
                            const next = [];
                            result.forEach((prefix) => {
                                opt.values.forEach((val) => {
                                    next.push([
                                        ...prefix,
                                        { optionName: opt.name || "خيار", value: val },
                                    ]);
                                });
                            });
                            result = next;
                        });
                        return result;
                    }

                    function updateVariantsTable() {
                        const options = collectOptions();
                        const combinations = buildCombinations(options);

                        variantsTableBody.innerHTML = "";

                        if (!combinations.length) {
                            if (variantsTableWrapper) {
                                variantsTableWrapper.style.display = "none";
                            }
                            return;
                        }

                        if (variantsTableWrapper) {
                            variantsTableWrapper.style.display = "block";
                        }

                        combinations.forEach((combo) => {
                            const tr = document.createElement("tr");

                            const valuesCell = document.createElement("td");
                            const labelText = combo
                                .map(
                                    (pair) =>
                                        `${pair.optionName || "خيار"}/${pair.value}`
                                )
                                .join(" ، ");
                            valuesCell.textContent = labelText;
                            tr.appendChild(valuesCell);

                            const priceCell = document.createElement("td");
                            const priceInput = document.createElement("input");
                            priceInput.type = "number";
                            priceInput.step = "0.01";
                            priceCell.appendChild(priceInput);
                            tr.appendChild(priceCell);

                            const qtyCell = document.createElement("td");
                            const qtyInput = document.createElement("input");
                            qtyInput.type = "number";
                            qtyCell.appendChild(qtyInput);
                            tr.appendChild(qtyCell);

                            const skuCell = document.createElement("td");
                            const skuInput = document.createElement("input");
                            skuInput.type = "text";
                            skuCell.appendChild(skuInput);
                            tr.appendChild(skuCell);

                            variantsTableBody.appendChild(tr);
                        });
                    }

                    function createValueTag(text, optionContainer) {
                        const tag = document.createElement("span");
                        tag.className = "wd-product-option-value-tag";

                        const label = document.createElement("span");
                        label.textContent = text;
                        tag.appendChild(label);

                        const removeBtn = document.createElement("button");
                        removeBtn.type = "button";
                        removeBtn.className = "wd-product-option-value-remove";
                        removeBtn.innerHTML = "&times;";
                        removeBtn.addEventListener("click", function () {
                            tag.remove();
                            if (
                                optionContainer.querySelectorAll(
                                    ".wd-product-option-value-tag"
                                ).length === 0
                            ) {
                                // إذا لم يعد هناك أي قيم في كل الخيارات، أخفِ الجدول
                                updateVariantsTable();
                            } else {
                                updateVariantsTable();
                            }
                        });

                        tag.appendChild(removeBtn);
                        return tag;
                    }

                    function createOption() {
                        const optionWrapper = document.createElement("div");
                        optionWrapper.className = "wd-product-option";

                        const row = document.createElement("div");
                        row.className = "wd-product-option-row";

                        const nameField = document.createElement("div");
                        nameField.className = "wd-product-details-field";
                        const nameLabel = document.createElement("label");
                        nameLabel.textContent = "اسم الخيار";
                        const nameInput = document.createElement("input");
                        nameInput.type = "text";
                        nameInput.placeholder = "مثل: اللون أو المقاس";
                        nameInput.className = "wd-product-option-name";
                        nameField.appendChild(nameLabel);
                        nameField.appendChild(nameInput);

                        const valuesField = document.createElement("div");
                        valuesField.className = "wd-product-details-field";
                        const valuesLabel = document.createElement("label");
                        valuesLabel.textContent = "قيم الخيار";
                        const valueInputWrapper = document.createElement("div");
                        valueInputWrapper.className =
                            "wd-product-option-value-input";
                        const valueInput = document.createElement("input");
                        valueInput.type = "text";
                        valueInput.placeholder = "اكتب القيمة واضغط Enter";
                        valueInput.className =
                            "wd-product-option-value-input-field";
                        valueInputWrapper.appendChild(valueInput);
                        valuesField.appendChild(valuesLabel);
                        valuesField.appendChild(valueInputWrapper);

                        const removeOptionBtn = document.createElement("button");
                        removeOptionBtn.type = "button";
                        removeOptionBtn.className = "wd-product-option-remove";
                        removeOptionBtn.innerHTML = '<i class="fas fa-trash"></i>';

                        row.appendChild(nameField);
                        row.appendChild(valuesField);
                        row.appendChild(removeOptionBtn);

                        optionWrapper.appendChild(row);
                        variantsOptionsContainer.appendChild(optionWrapper);

                        if (emptyPlaceholder) {
                            emptyPlaceholder.style.display = "none";
                        }

                        function addValueFromInput() {
                            const raw = valueInput.value.trim();
                            if (!raw) return;

                            const existing = valueInputWrapper.querySelectorAll(
                                ".wd-product-option-value-tag span"
                            );
                            const existsAlready = Array.from(existing).some(
                                (sp) => sp.textContent.trim() === raw
                            );
                            if (existsAlready) {
                                valueInput.value = "";
                                return;
                            }

                            const tag = createValueTag(raw, valueInputWrapper);
                            valueInputWrapper.insertBefore(tag, valueInput);
                            valueInput.value = "";
                            updateVariantsTable();
                        }

                        valueInput.addEventListener("keydown", function (e) {
                            if (e.key === "Enter") {
                                e.preventDefault();
                                addValueFromInput();
                            }
                        });

                        nameInput.addEventListener("input", function () {
                            updateVariantsTable();
                        });

                        removeOptionBtn.addEventListener("click", function () {
                            optionWrapper.remove();
                            if (
                                variantsOptionsContainer.querySelectorAll(
                                    ".wd-product-option"
                                ).length === 0
                            ) {
                                if (emptyPlaceholder) {
                                    emptyPlaceholder.style.display = "block";
                                }
                            }
                            updateVariantsTable();
                        });
                    }

                    addOptionBtn.addEventListener("click", function () {
                        createOption();
                    });

                    detailsRow.dataset.variantsInitialized = "1";
                }

                mainRow.addEventListener("click", function (e) {
                    // السماح بزر التفاصيل بتوسيع الصف، وتجاهل أزرار/حقول التفاصيل فقط
                    const isToggle = e.target.closest(".wd-product-toggle");
                    const isDetailsControl = e.target.closest(
                        ".wd-product-details-actions button, .wd-product-details-field input, .wd-product-details-field select"
                    );
                    if (!isToggle && isDetailsControl) return;

                    const isHidden = detailsRow.style.display === "none";
                    if (isHidden) {
                        // إغلاق أي تفاصيل أخرى مفتوحة قبل فتح هذا المنتج
                        document
                            .querySelectorAll(".wd-product-details-row")
                            .forEach((row) => {
                                if (row !== detailsRow) {
                                    row.style.display = "none";
                                }
                            });

                        fillDetailsFromMain();
                        detailsRow.style.display = "table-row";
                    } else {
                        detailsRow.style.display = "none";
                    }
                });

                saveBtn.addEventListener("click", function () {
                    const newName = nameInput.value.trim() || nameCell.textContent.trim();
                    const newShipping =
                        (shippingInput && shippingInput.value) ||
                        (shippingCell ? shippingCell.textContent.trim() : "");
                    const newPrice = priceInput.value.trim() || priceCell.textContent.trim();
                    const newQty = qtyInput.value.trim() || qtyCell.textContent.trim();
                    const newStatus = statusInput.value;

                    nameCell.textContent = newName;
                    if (shippingCell) {
                        shippingCell.textContent = newShipping;
                    }
                    priceCell.textContent = newPrice;
                    qtyCell.textContent = newQty;
                    statusCell.textContent = newStatus;

                    detailsRow.style.display = "none";
                });

                deleteBtn.addEventListener("click", function () {
                    if (!confirm("هل أنت متأكد من حذف هذا المنتج؟")) return;
                    mainRow.remove();
                    detailsRow.remove();
                });

                cancelBtn.addEventListener("click", function () {
                    detailsRow.style.display = "none";
                });

                // تهيئة منطق الخيارات مباشرة لأول مرة بحيث يعمل زر "إضافة خيار" فوراً
                setupVariants();
            }

            function initProductsTable() {
                const productRows = document.querySelectorAll(
                    "#productsTableBody .wd-product-row"
                );
                productRows.forEach((row) => setupProductRow(row));
            }

            function addNewProductRow() {
                const tbody = document.getElementById("productsTableBody");
                if (!tbody) return;

                const productId = `product-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                const mainRow = document.createElement("tr");
                mainRow.className = "wd-product-row";
                mainRow.setAttribute("data-product-id", productId);
                mainRow.innerHTML = `
            <td class="wd-product-toggle-cell">
              <button
                type="button"
                class="wd-btn-secondary wd-product-toggle"
              >
                <i class="fas fa-chevron-down"></i>
              </button>
            </td>
            <td>
              <div class="wd-product-image">
                <img src="" alt="صورة المنتج" data-image-src="" />
              </div>
            </td>
            <td class="wd-product-name"></td>
            <td class="wd-product-shipping"></td>
            <td class="wd-product-price"></td>
            <td class="wd-product-qty"></td>
            <td class="wd-product-status"></td>
          `;

                const detailsRow = document.createElement("tr");
                detailsRow.className = "wd-product-details-row";
                detailsRow.style.display = "table-row";
                let detailsRowHTML = `
            <td colspan="7">
              <div class="wd-product-details">
                <!-- القسم الأول: معلومات أساسية (اسم + حالة + وصف) مع صورة المنتج -->
                <div class="wd-product-section">
                  <div class="wd-product-main-grid">
                    <div class="wd-product-main-text">
                      <div class="wd-product-main-row">
                        <div class="wd-product-details-field">
                          <label>اسم المنتج</label>
                          <input
                            type="text"
                            class="wd-product-input-name"
                            placeholder="اسم المنتج"
                          />
                        </div>
                        <div class="wd-product-details-field">
                          <label>حالة المنتج</label>
                          <select class="wd-product-input-status">
                            <option value="متوفر">متوفر</option>
                            <option value="غير متوفر">غير متوفر</option>
                          </select>
                        </div>
                      </div>
                      <div class="wd-product-details-field">
                        <label>وصف المنتج</label>
                        <textarea
                          class="wd-product-input-description"
                          placeholder="اكتب وصفاً موجزاً للمنتج"
                        ></textarea>
                      </div>
                    </div>
                    <div class="wd-product-main-image">
                      <label>صورة المنتج</label>
                      <div class="wd-product-image-upload">
                        <span class="wd-product-image-placeholder">انقر لرفع صورة المنتج</span>
                        <img
                          class="wd-product-image-preview"
                          alt="معاينة صورة المنتج"
                        />
                        <input
                          type="file"
                          class="wd-product-input-image"
                          accept="image/*"
                        />
                      </div>
                    </div>
                  </div>
                </div>

                <!-- القسم الثاني: الأسعار والضريبة -->
                <div class="wd-product-section">
                  <div class="wd-product-details-grid">
                    <div class="wd-product-details-field">
                      <label>سعر المنتج</label>
                      <input
                        type="number"
                        step="0.01"
                        class="wd-product-input-price"
                        placeholder="0.00"
                      />
                    </div>
                    <div class="wd-product-details-field">
                      <label>السعر قبل الخصم</label>
                      <input
                        type="number"
                        step="0.01"
                        class="wd-product-input-compare-price"
                        placeholder="0.00"
                      />
                    </div>
                    <div class="wd-product-details-field wd-shipping-cost-field" style="display: none;">
                      <label>تكلفة الشحن</label>
                      <input
                        type="number"
                        step="0.01"
                        class="wd-product-input-shipping-cost"
                        placeholder="0.00"
                      />
                    </div>
                    <div class="wd-product-details-field">
                      <label>شامل تكلفة الشحن</label>
                      <div class="wd-switch-inline">
                        <input
                          type="checkbox"
                          class="wd-product-input-shipping-included"
                          id="shipping-included-PRODUCT_ID"
                        />
                        <label for="shipping-included-PRODUCT_ID" style="margin: 0; cursor: pointer;">
                          المنتج شامل تكلفة الشحن
                        </label>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- القسم الثالث: SKU والكمية والشحن -->
                <div class="wd-product-section">
                  <div class="wd-product-details-grid">
                    <div class="wd-product-details-field">
                      <label>رمز المنتج SKU</label>
                      <input
                        type="text"
                        class="wd-product-input-sku"
                        placeholder="مثال: SKU-001"
                      />
                    </div>
                    <div class="wd-product-details-field">
                      <label>شركة الشحن</label>
                      <select class="wd-product-input-shipping">
                        <option value="">اختر شركة الشحن</option>
                        <option value="ارامكس">أرامكس</option>
                        <option value="DHL">DHL</option>
                        <option value="سمسا">سمسا</option>
                        <option value="فيديكس">فيديكس</option>
                      </select>
                    </div>
                    <div class="wd-product-details-field">
                      <label>كمية المنتج</label>
                      <input
                        type="number"
                        class="wd-product-input-qty"
                        placeholder="0"
                      />
                    </div>
                  </div>
                </div>

                                <!-- القسم الرابع: خيارات المنتج (التباينات) -->
                <div class="wd-product-section">
                  <div class="wd-product-variants-header">
                    <div>
                      <div class="wd-product-section-title">خيارات المنتج</div>
                      <div class="wd-product-variants-subtitle">
                        (مثل المقاسات أو الألوان)
                      </div>
                    </div>
                    <button
                      type="button"
                      class="wd-btn-secondary wd-product-add-option"
                    >
                      + إضافة خيار
                    </button>
                  </div>
                  <div class="wd-product-variants-options">
                    <div class="wd-product-variants-empty">
                      لا توجد خيارات بعد، اضغط زر "إضافة خيار" لإضافة أول خيار.
                    </div>
                  </div>
                  <div
                    class="wd-variants-table-wrapper"
                    style="display: none"
                  >
                    <table class="wd-variants-table">
                      <thead>
                        <tr>
                          <th>القيم</th>
                          <th>السعر</th>
                          <th>الكمية</th>
                          <th>SKU</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>


                <div class="wd-product-details-actions">
                  <button
                    type="button"
                    class="wd-btn wd-product-save"
                  >
                    حفظ
                  </button>
                  <button
                    type="button"
                    class="wd-btn-danger wd-product-delete"
                  >
                    حذف المنتج
                  </button>
                  <button
                    type="button"
                    class="wd-btn-secondary wd-product-cancel"
                  >
                    إلغاء
                  </button>
                </div>
              </div>
            </td>
          `;
                detailsRowHTML = detailsRowHTML.replace(/PRODUCT_ID/g, productId);
                detailsRow.innerHTML = detailsRowHTML;

                const firstRow = tbody.firstChild;
                if (firstRow) {
                    tbody.insertBefore(detailsRow, firstRow);
                    tbody.insertBefore(mainRow, detailsRow);
                } else {
                    tbody.appendChild(mainRow);
                    tbody.appendChild(detailsRow);
                }

                setupProductRow(mainRow);
            }

            // ========== وظائف الخصومات ==========
            function setupDiscountRow(mainRow) {
                const detailsRow = mainRow.nextElementSibling;
                if (!detailsRow) return;

                const codeCell = mainRow.querySelector(".wd-discount-code-cell");
                const typeCell = mainRow.querySelector(".wd-discount-type-cell");
                const valueCell = mainRow.querySelector(".wd-discount-value-cell");
                const expiryCell = mainRow.querySelector(".wd-discount-expiry-cell");
                const usesCell = mainRow.querySelector(".wd-discount-uses-cell");
                const statusCell = mainRow.querySelector(".wd-discount-status-cell");

                const codeInput = detailsRow.querySelector(".wd-discount-input-code");
                const typeInput = detailsRow.querySelector(".wd-discount-input-type");
                const valueInput = detailsRow.querySelector(".wd-discount-input-value");
                const minOrderInput = detailsRow.querySelector(".wd-discount-input-min-order");
                const maxUsesInput = detailsRow.querySelector(".wd-discount-input-max-uses");
                const expiryInput = detailsRow.querySelector(".wd-discount-input-expiry");
                const statusInput = detailsRow.querySelector(".wd-discount-input-status");

                const saveBtn = detailsRow.querySelector(".wd-discount-save");
                const deleteBtn = detailsRow.querySelector(".wd-discount-delete");
                const cancelBtn = detailsRow.querySelector(".wd-discount-cancel");

                // عناصر ينطبق على
                const appliesToInput = detailsRow.querySelector(".wd-discount-input-applies-to");
                const productsSelectContainer = detailsRow.querySelector(".wd-discount-products-select");
                const productCheckboxes = detailsRow.querySelectorAll(".wd-discount-product-item input[type='checkbox']");
                const selectedProductsTags = detailsRow.querySelector(".wd-selected-products-tags");

                // عناصر المتطلبات الدنيا
                const minRequirementInput = detailsRow.querySelector(".wd-discount-input-min-requirement");
                const minAmountField = detailsRow.querySelector(".wd-discount-min-amount-field");
                const minQuantityField = detailsRow.querySelector(".wd-discount-min-quantity-field");

                // إظهار/إخفاء حقول المتطلبات الدنيا
                if (minRequirementInput && minAmountField && minQuantityField) {
                    minRequirementInput.addEventListener("change", function () {
                        minAmountField.classList.remove("visible");
                        minQuantityField.classList.remove("visible");

                        if (this.value === "min-amount") {
                            minAmountField.classList.add("visible");
                        } else if (this.value === "min-quantity") {
                            minQuantityField.classList.add("visible");
                        }
                    });
                }

                // إظهار/إخفاء قائمة المنتجات
                if (appliesToInput && productsSelectContainer) {
                    appliesToInput.addEventListener("change", function () {
                        if (this.value === "specific") {
                            productsSelectContainer.classList.add("visible");
                        } else {
                            productsSelectContainer.classList.remove("visible");
                            // إلغاء تحديد جميع المنتجات
                            productCheckboxes.forEach(cb => {
                                cb.checked = false;
                                cb.closest(".wd-discount-product-item").classList.remove("selected");
                            });
                            if (selectedProductsTags) selectedProductsTags.innerHTML = "";
                        }
                    });
                }

                // تحديث المنتجات المحددة
                function updateSelectedProductsTags() {
                    if (!selectedProductsTags) return;
                    selectedProductsTags.innerHTML = "";
                    productCheckboxes.forEach(cb => {
                        if (cb.checked) {
                            const productName = cb.nextElementSibling.textContent;
                            const tag = document.createElement("span");
                            tag.className = "wd-selected-product-tag";
                            tag.innerHTML = '<span>' + productName + '</span><button type="button">&times;</button>';
                            tag.querySelector("button").addEventListener("click", function () {
                                cb.checked = false;
                                cb.closest(".wd-discount-product-item").classList.remove("selected");
                                updateSelectedProductsTags();
                            });
                            selectedProductsTags.appendChild(tag);
                        }
                    });
                }

                productCheckboxes.forEach(cb => {
                    cb.addEventListener("change", function () {
                        if (this.checked) {
                            this.closest(".wd-discount-product-item").classList.add("selected");
                        } else {
                            this.closest(".wd-discount-product-item").classList.remove("selected");
                        }
                        updateSelectedProductsTags();
                    });
                });

                function fillDetailsFromMain() {
                    if (codeInput && codeCell) codeInput.value = codeCell.textContent.trim();
                    if (valueInput && valueCell) valueInput.value = valueCell.textContent.replace(/[^\d.]/g, '');
                    if (statusInput && statusCell) {
                        const statusText = statusCell.textContent.trim();
                        if (statusText === "نشط") statusInput.value = "active";
                        else if (statusText === "منتهي") statusInput.value = "expired";
                        else statusInput.value = "inactive";
                    }
                }

                mainRow.addEventListener("click", function (e) {
                    const isToggle = e.target.closest(".wd-discount-toggle");
                    const isDetailsControl = e.target.closest(
                        ".wd-product-details-actions button, .wd-product-details-field input, .wd-product-details-field select"
                    );
                    if (!isToggle && isDetailsControl) return;

                    const isHidden = detailsRow.style.display === "none";
                    if (isHidden) {
                        document.querySelectorAll(".wd-discount-details-row").forEach((row) => {
                            if (row !== detailsRow) row.style.display = "none";
                        });
                        fillDetailsFromMain();
                        detailsRow.style.display = "table-row";
                    } else {
                        detailsRow.style.display = "none";
                    }
                });

                if (saveBtn) {
                    saveBtn.addEventListener("click", function () {
                        const newCode = codeInput ? codeInput.value.trim() : "";
                        const newType = typeInput ? typeInput.value : "percentage";
                        const newValue = valueInput ? valueInput.value.trim() : "";
                        const newExpiry = expiryInput ? expiryInput.value : "";
                        const newMaxUses = maxUsesInput ? maxUsesInput.value : "";
                        const newStatus = statusInput ? statusInput.value : "active";

                        if (codeCell) codeCell.textContent = newCode;
                        if (typeCell) {
                            typeCell.innerHTML = newType === "percentage"
                                ? '<span class="wd-discount-type percentage"><i class="fas fa-percent"></i> نسبة مئوية</span>'
                                : '<span class="wd-discount-type fixed"><i class="fas fa-coins"></i> مبلغ ثابت</span>';
                        }
                        if (valueCell) {
                            valueCell.textContent = newType === "percentage" ? newValue + "%" : newValue + " ر.س";
                        }
                        if (expiryCell) expiryCell.textContent = newExpiry || "-";
                        if (usesCell) usesCell.textContent = "0 / " + (newMaxUses || "∞");
                        if (statusCell) {
                            let statusClass = "active";
                            let statusText = "نشط";
                            if (newStatus === "expired") { statusClass = "expired"; statusText = "منتهي"; }
                            else if (newStatus === "inactive") { statusClass = "inactive"; statusText = "غير نشط"; }
                            statusCell.innerHTML = '<span class="wd-discount-status ' + statusClass + '">' + statusText + '</span>';
                        }

                        detailsRow.style.display = "none";
                    });
                }

                if (deleteBtn) {
                    deleteBtn.addEventListener("click", function () {
                        if (!confirm("هل أنت متأكد من حذف هذا الخصم؟")) return;
                        mainRow.remove();
                        detailsRow.remove();
                    });
                }

                if (cancelBtn) {
                    cancelBtn.addEventListener("click", function () {
                        detailsRow.style.display = "none";
                    });
                }
            }

            function initDiscountsTable() {
                const discountRows = document.querySelectorAll("#discountsTableBody .wd-discount-row");
                discountRows.forEach((row) => setupDiscountRow(row));
            }

            function addNewDiscountRow() {
                const tbody = document.getElementById("discountsTableBody");
                if (!tbody) return;

                const discountId = `discount-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                const mainRow = document.createElement("tr");
                mainRow.className = "wd-discount-row";
                mainRow.setAttribute("data-discount-id", discountId);
                mainRow.innerHTML = `
                    <td class="wd-discount-toggle-cell">
                        <button type="button" class="wd-btn-secondary wd-discount-toggle">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </td>
                    <td class="wd-discount-code-cell"><span class="wd-discount-code"></span></td>
                    <td class="wd-discount-type-cell"></td>
                    <td class="wd-discount-value-cell"></td>
                    <td class="wd-discount-expiry-cell"></td>
                    <td class="wd-discount-uses-cell"></td>
                    <td class="wd-discount-status-cell"></td>
                `;

                const detailsRow = document.createElement("tr");
                detailsRow.className = "wd-discount-details-row";
                detailsRow.style.display = "table-row";
                detailsRow.innerHTML = `
                    <td colspan="7">
                        <div class="wd-product-details">
                            <div class="wd-product-section">
                                <div class="wd-product-details-grid">
                                    <div class="wd-product-details-field">
                                        <label>رمز الخصم</label>
                                        <input type="text" class="wd-discount-input-code" placeholder="مثال: SAVE20" style="text-transform: uppercase;" />
                                    </div>
                                    <div class="wd-product-details-field">
                                        <label>نوع الخصم</label>
                                        <select class="wd-discount-input-type">
                                            <option value="percentage">نسبة مئوية (%)</option>
                                            <option value="fixed">مبلغ ثابت (ر.س)</option>
                                        </select>
                                    </div>
                                    <div class="wd-product-details-field">
                                        <label>قيمة الخصم</label>
                                        <input type="number" step="0.01" class="wd-discount-input-value" placeholder="0" />
                                    </div>
                                    <div class="wd-product-details-field">
                                        <label>الحد الأقصى للاستخدامات</label>
                                        <input type="number" class="wd-discount-input-max-uses" placeholder="غير محدود" />
                                    </div>
                                </div>
                            </div>
                            <div class="wd-product-section">
                                <div class="wd-product-details-grid">
                                    <div class="wd-product-details-field">
                                        <label>تاريخ البداية</label>
                                        <input type="date" class="wd-discount-input-start-date" />
                                    </div>
                                    <div class="wd-product-details-field">
                                        <label>تاريخ الانتهاء</label>
                                        <input type="date" class="wd-discount-input-expiry" />
                                    </div>
                                    <div class="wd-product-details-field">
                                        <label>الحالة</label>
                                        <select class="wd-discount-input-status">
                                            <option value="active">نشط</option>
                                            <option value="inactive">غير نشط</option>
                                            <option value="expired">منتهي</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="wd-product-section">
                                <div class="wd-product-section-title">المتطلبات الدنيا</div>
                                <div class="wd-discount-min-requirements">
                                    <div class="wd-product-details-field">
                                        <select class="wd-discount-input-min-requirement">
                                            <option value="none" selected>لا شيء</option>
                                            <option value="min-amount">أدنى مبلغ للشراء</option>
                                            <option value="min-quantity">الحد الأدنى لكمية العناصر</option>
                                        </select>
                                    </div>
                                    <div class="wd-discount-min-value-field wd-discount-min-amount-field">
                                        <div class="wd-product-details-field" style="flex: 1;">
                                            <label>أدنى مبلغ للشراء (ر.س)</label>
                                            <input type="number" step="0.01" class="wd-discount-input-min-amount" placeholder="0.00" />
                                        </div>
                                    </div>
                                    <div class="wd-discount-min-value-field wd-discount-min-quantity-field">
                                        <div class="wd-product-details-field" style="flex: 1;">
                                            <label>الحد الأدنى لكمية العناصر</label>
                                            <input type="number" class="wd-discount-input-min-quantity" placeholder="1" min="1" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="wd-product-section">
                                <div class="wd-product-section-title">ينطبق على</div>
                                <div class="wd-discount-applies-to">
                                    <div class="wd-product-details-field">
                                        <select class="wd-discount-input-applies-to">
                                            <option value="all">الطلب كاملاً</option>
                                            <option value="specific">منتجات محددة</option>
                                        </select>
                                    </div>
                                    <div class="wd-discount-products-select">
                                        <label style="font-size: 12px; color: #666;">اختر المنتجات:</label>
                                        <div class="wd-discount-products-list">
                                            <label class="wd-discount-product-item">
                                                <input type="checkbox" value="product-1" />
                                                <span>منتج تجريبي 1</span>
                                            </label>
                                            <label class="wd-discount-product-item">
                                                <input type="checkbox" value="product-2" />
                                                <span>منتج تجريبي 2</span>
                                            </label>
                                            <label class="wd-discount-product-item">
                                                <input type="checkbox" value="product-3" />
                                                <span>منتج تجريبي 3</span>
                                            </label>
                                            <label class="wd-discount-product-item">
                                                <input type="checkbox" value="product-4" />
                                                <span>منتج تجريبي 4</span>
                                            </label>
                                            <label class="wd-discount-product-item">
                                                <input type="checkbox" value="product-5" />
                                                <span>منتج تجريبي 5</span>
                                            </label>
                                        </div>
                                        <div class="wd-selected-products-tags"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="wd-product-details-actions">
                                <button type="button" class="wd-btn wd-discount-save">حفظ</button>
                                <button type="button" class="wd-btn-danger wd-discount-delete">حذف</button>
                                <button type="button" class="wd-btn-secondary wd-discount-cancel">إلغاء</button>
                            </div>
                        </div>
                    </td>
                `;

                const firstRow = tbody.firstChild;
                if (firstRow) {
                    tbody.insertBefore(detailsRow, firstRow);
                    tbody.insertBefore(mainRow, detailsRow);
                } else {
                    tbody.appendChild(mainRow);
                    tbody.appendChild(detailsRow);
                }

                setupDiscountRow(mainRow);
            }

            function updateStoreActionButton(activeTab) {
                if (!actionBtn) return;

                if (activeTab === "products") {
                    actionBtn.style.display = "flex";
                    actionBtn.innerHTML = '<i class="fas fa-plus"></i> إضافة منتج';
                    actionBtn.onclick = function () {
                        addNewProductRow();
                    };
                } else if (activeTab === "discounts") {
                    actionBtn.style.display = "flex";
                    actionBtn.innerHTML = '<i class="fas fa-plus"></i> إضافة خصم';
                    actionBtn.onclick = function () {
                        addNewDiscountRow();
                    };
                } else {
                    actionBtn.style.display = "none";
                    actionBtn.onclick = null;
                }
            }

            tabs.forEach((tab) => {
                tab.addEventListener("click", () => {
                    const target = tab.getAttribute("data-tab");

                    tabs.forEach((t) => t.classList.remove("wd-tab-active"));
                    tab.classList.add("wd-tab-active");

                    contents.forEach((content) => {
                        if (content.getAttribute("data-tab-content") === target) {
                            content.classList.add("wd-tab-content-active");
                        } else {
                            content.classList.remove("wd-tab-content-active");
                        }
                    });

                    updateStoreActionButton(target);
                });
            });

            // تهيئة زر الهيدر حسب التبويب الافتراضي (الطلبات -> بدون زر)
            updateStoreActionButton("orders");

            // تهيئة جدول المنتجات (الصف الافتراضي)
            initProductsTable();

            // تهيئة جدول الخصومات
            initDiscountsTable();

            // تهيئة جداول المحفظة مع Pagination
            initWalletTables();

            // إعدادات التوصيل - إظهار/إخفاء خيارات التوصيل
            const deliveryOption = document.getElementById("deliveryOption");
            const deliverySettings = document.getElementById("deliverySettings");
            if (deliveryOption && deliverySettings) {
                deliveryOption.addEventListener("change", function () {
                    if (this.checked) {
                        deliverySettings.classList.add("visible");
                    } else {
                        deliverySettings.classList.remove("visible");
                    }
                });
            }
        });

        // ========== نظام Pagination المتقدم ==========
        class AdvancedPagination {
            constructor(options) {
                this.data = options.data || [];
                this.tableBodyId = options.tableBodyId;
                this.paginationId = options.paginationId;
                this.renderRow = options.renderRow;
                this.perPage = options.perPage || 10;
                this.currentPage = 1;
                this.init();
            }

            get totalPages() {
                return Math.ceil(this.data.length / this.perPage);
            }

            get startIndex() {
                return (this.currentPage - 1) * this.perPage;
            }

            get endIndex() {
                return Math.min(this.startIndex + this.perPage, this.data.length);
            }

            init() {
                this.render();
            }

            render() {
                this.renderTable();
                this.renderPagination();
            }

            renderTable() {
                const tbody = document.getElementById(this.tableBodyId);
                if (!tbody) return;

                const pageData = this.data.slice(this.startIndex, this.endIndex);
                tbody.innerHTML = pageData.map(this.renderRow).join('');
            }

            renderPagination() {
                const container = document.getElementById(this.paginationId);
                if (!container) return;

                const { currentPage, totalPages, data, startIndex, endIndex, perPage } = this;

                let pagesHtml = '';

                // First page
                if (totalPages > 0) {
                    pagesHtml += `<button class="wd-pagination-btn ${currentPage === 1 ? 'active' : ''}" onclick="window.${this.tableBodyId}Pagination.goToPage(1)">1</button>`;
                }

                // Ellipsis and middle pages
                if (totalPages > 7) {
                    if (currentPage > 4) {
                        pagesHtml += '<span class="wd-pagination-ellipsis">...</span>';
                    }

                    const start = Math.max(2, currentPage - 1);
                    const end = Math.min(totalPages - 1, currentPage + 1);

                    for (let i = start; i <= end; i++) {
                        if (i !== 1 && i !== totalPages) {
                            pagesHtml += `<button class="wd-pagination-btn ${currentPage === i ? 'active' : ''}" onclick="window.${this.tableBodyId}Pagination.goToPage(${i})">${i}</button>`;
                        }
                    }

                    if (currentPage < totalPages - 3) {
                        pagesHtml += '<span class="wd-pagination-ellipsis">...</span>';
                    }
                } else {
                    for (let i = 2; i < totalPages; i++) {
                        pagesHtml += `<button class="wd-pagination-btn ${currentPage === i ? 'active' : ''}" onclick="window.${this.tableBodyId}Pagination.goToPage(${i})">${i}</button>`;
                    }
                }

                // Last page
                if (totalPages > 1) {
                    pagesHtml += `<button class="wd-pagination-btn ${currentPage === totalPages ? 'active' : ''}" onclick="window.${this.tableBodyId}Pagination.goToPage(${totalPages})">${totalPages}</button>`;
                }

                container.innerHTML = `
                    <div class="wd-pagination-info">
                        عرض <strong>${startIndex + 1}</strong> إلى <strong>${endIndex}</strong> من <strong>${data.length}</strong> سجل
                    </div>
                    <div class="wd-pagination-controls">
                        <button class="wd-pagination-btn wd-pagination-nav" ${currentPage === 1 ? 'disabled' : ''} onclick="window.${this.tableBodyId}Pagination.prevPage()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        ${pagesHtml}
                        <button class="wd-pagination-btn wd-pagination-nav" ${currentPage === totalPages ? 'disabled' : ''} onclick="window.${this.tableBodyId}Pagination.nextPage()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    </div>
                    <div class="wd-pagination-jump">
                        <span>الذهاب للصفحة:</span>
                        <input type="number" min="1" max="${totalPages}" value="${currentPage}" id="${this.tableBodyId}JumpInput" />
                        <button onclick="window.${this.tableBodyId}Pagination.jumpToPage()">انتقال</button>
                    </div>
                `;
            }

            goToPage(page) {
                if (page >= 1 && page <= this.totalPages) {
                    this.currentPage = page;
                    this.render();
                }
            }

            prevPage() {
                this.goToPage(this.currentPage - 1);
            }

            nextPage() {
                this.goToPage(this.currentPage + 1);
            }

            jumpToPage() {
                const input = document.getElementById(`${this.tableBodyId}JumpInput`);
                if (input) {
                    const page = parseInt(input.value);
                    this.goToPage(page);
                }
            }
        }

        // بيانات سجل العمليات
        const transactionsData = [
            { date: '01/02/2025 14:30', type: 'deposit', desc: 'إضافة رصيد - تحويل بنكي', amount: '+5,000.00', balance: '12,500.00' },
            { date: '31/01/2025 10:15', type: 'order', desc: 'طلب #1005 - دفع من المحفظة', amount: '-350.00', balance: '7,500.00' },
            { date: '30/01/2025 16:45', type: 'withdraw', desc: 'سحب رصيد إلى الحساب البنكي', amount: '-2,000.00', balance: '7,850.00' },
            { date: '28/01/2025 09:00', type: 'deposit', desc: 'إضافة رصيد - بطاقة ائتمان', amount: '+10,000.00', balance: '9,850.00' },
            { date: '25/01/2025 11:30', type: 'order', desc: 'طلب #1004 - دفع من المحفظة', amount: '-150.00', balance: '-150.00' },
            { date: '23/01/2025 14:00', type: 'deposit', desc: 'إضافة رصيد - Apple Pay', amount: '+3,000.00', balance: '3,000.00' },
            { date: '20/01/2025 09:45', type: 'withdraw', desc: 'سحب رصيد إلى الحساب البنكي', amount: '-1,500.00', balance: '-150.00' },
            { date: '18/01/2025 16:20', type: 'order', desc: 'طلب #1003 - دفع من المحفظة', amount: '-280.00', balance: '1,350.00' },
            { date: '15/01/2025 10:00', type: 'deposit', desc: 'إضافة رصيد - تحويل بنكي', amount: '+2,500.00', balance: '1,630.00' },
            { date: '12/01/2025 13:30', type: 'order', desc: 'طلب #1002 - دفع من المحفظة', amount: '-420.00', balance: '-870.00' },
            { date: '10/01/2025 08:15', type: 'deposit', desc: 'إضافة رصيد - مدى', amount: '+1,000.00', balance: '-450.00' },
            { date: '08/01/2025 15:45', type: 'withdraw', desc: 'سحب رصيد إلى الحساب البنكي', amount: '-500.00', balance: '-1,450.00' },
            { date: '05/01/2025 11:00', type: 'order', desc: 'طلب #1001 - دفع من المحفظة', amount: '-180.00', balance: '-950.00' },
            { date: '03/01/2025 09:30', type: 'deposit', desc: 'إضافة رصيد - STC Pay', amount: '+800.00', balance: '-770.00' },
            { date: '01/01/2025 14:00', type: 'deposit', desc: 'رصيد افتتاحي', amount: '+5,000.00', balance: '-1,570.00' },
        ];

        // بيانات سجلات الدفع
        const paymentLogsData = [
            { order: '#1020', date: '05/02/2025 14:30', customer: 'محمد أحمد', method: 'بطاقة ائتمان', amount: '450.00', status: 'success' },
            { order: '#1019', date: '05/02/2025 12:15', customer: 'سارة علي', method: 'مدى', amount: '280.00', status: 'success' },
            { order: '#1018', date: '04/02/2025 16:30', customer: 'خالد محمود', method: 'Apple Pay', amount: '1,200.00', status: 'failed' },
            { order: '#1017', date: '04/02/2025 14:15', customer: 'نورة سعد', method: 'تحويل بنكي', amount: '890.00', status: 'pending' },
            { order: '#1016', date: '03/02/2025 12:00', customer: 'عبدالله فهد', method: 'STC Pay', amount: '350.00', status: 'success' },
            { order: '#1015', date: '03/02/2025 09:45', customer: 'فاطمة أحمد', method: 'بطاقة ائتمان', amount: '720.00', status: 'success' },
            { order: '#1014', date: '02/02/2025 15:30', customer: 'عمر حسن', method: 'مدى', amount: '560.00', status: 'success' },
            { order: '#1013', date: '02/02/2025 11:00', customer: 'ريم محمد', method: 'Apple Pay', amount: '980.00', status: 'failed' },
            { order: '#1012', date: '01/02/2025 14:45', customer: 'أحمد سعيد', method: 'تحويل بنكي', amount: '1,500.00', status: 'success' },
            { order: '#1011', date: '01/02/2025 10:30', customer: 'منى خالد', method: 'STC Pay', amount: '420.00', status: 'success' },
            { order: '#1010', date: '31/01/2025 16:15', customer: 'يوسف علي', method: 'بطاقة ائتمان', amount: '680.00', status: 'pending' },
            { order: '#1009', date: '31/01/2025 13:00', customer: 'هدى سالم', method: 'مدى', amount: '230.00', status: 'success' },
            { order: '#1008', date: '30/01/2025 15:45', customer: 'سلطان ناصر', method: 'Apple Pay', amount: '1,100.00', status: 'success' },
            { order: '#1007', date: '30/01/2025 11:30', customer: 'لمى عبدالله', method: 'تحويل بنكي', amount: '590.00', status: 'failed' },
            { order: '#1006', date: '29/01/2025 14:00', customer: 'طارق فيصل', method: 'STC Pay', amount: '340.00', status: 'success' },
            { order: '#1005', date: '29/01/2025 09:15', customer: 'نوف سعد', method: 'بطاقة ائتمان', amount: '870.00', status: 'success' },
        ];

        // تهيئة جداول المحفظة مع Pagination
        function initWalletTables() {
            // سجل العمليات
            window.transactionsTableBodyPagination = new AdvancedPagination({
                data: transactionsData,
                tableBodyId: 'transactionsTableBody',
                paginationId: 'transactionsPagination',
                perPage: 10,
                renderRow: (row) => {
                    const typeIcons = {
                        deposit: '<span class="wd-transaction-type deposit"><i class="fas fa-arrow-down"></i> إيداع</span>',
                        withdraw: '<span class="wd-transaction-type withdraw"><i class="fas fa-arrow-up"></i> سحب</span>',
                        order: '<span class="wd-transaction-type order"><i class="fas fa-shopping-cart"></i> طلب</span>'
                    };
                    const amountClass = row.amount.startsWith('+') ? 'positive' : 'negative';
                    return `<tr>
                        <td>${row.date}</td>
                        <td>${typeIcons[row.type]}</td>
                        <td>${row.desc}</td>
                        <td class="wd-transaction-amount ${amountClass}">${row.amount} ر.س</td>
                        <td>${row.balance} ر.س</td>
                    </tr>`;
                }
            });

            // سجلات الدفع
            window.paymentLogsTableBodyPagination = new AdvancedPagination({
                data: paymentLogsData,
                tableBodyId: 'paymentLogsTableBody',
                paginationId: 'paymentLogsPagination',
                perPage: 10,
                renderRow: (row) => {
                    const statusHtml = {
                        success: '<span class="wd-payment-status success"><i class="fas fa-check-circle"></i> ناجح</span>',
                        failed: '<span class="wd-payment-status failed"><i class="fas fa-times-circle"></i> فشل</span>',
                        pending: '<span class="wd-payment-status pending"><i class="fas fa-clock"></i> قيد الانتظار</span>'
                    };
                    return `<tr>
                        <td>${row.order}</td>
                        <td>${row.date}</td>
                        <td>${row.customer}</td>
                        <td>${row.method}</td>
                        <td>${row.amount} ر.س</td>
                        <td>${statusHtml[row.status]}</td>
                    </tr>`;
                }
            });
        }

        // وظائف المحفظة
        function showAddBalanceModal() {
            const amount = prompt("أدخل المبلغ المراد إضافته (ر.س):");
            if (amount && !isNaN(amount) && parseFloat(amount) > 0) {
                alert("تم طلب إضافة رصيد بقيمة " + amount + " ر.س\nسيتم تحويلك لصفحة الدفع.");
            }
        }

        function showWithdrawModal() {
            const amount = prompt("أدخل المبلغ المراد سحبه (ر.س):");
            if (amount && !isNaN(amount) && parseFloat(amount) > 0) {
                alert("تم طلب سحب رصيد بقيمة " + amount + " ر.س\nسيتم مراجعة الطلب وتحويل المبلغ خلال 24 ساعة.");
            }
        }

        // حفظ إعدادات المتجر
        function saveStoreSettings() {
            // جمع طرق الدفع المحددة
            const paymentMethods = [];
            document.querySelectorAll('input[name="paymentMethod"]:checked').forEach(cb => {
                paymentMethods.push(cb.value);
            });

            const settings = {
                storeName: document.getElementById("storeName")?.value || "",
                storeEmail: document.getElementById("storeEmail")?.value || "",
                storePhone: document.getElementById("storePhone")?.value || "",
                storeCategory: document.getElementById("storeCategory")?.value || "",
                legalName: document.getElementById("legalName")?.value || "",
                storeAddress: document.getElementById("storeAddress")?.value || "",
                storeCountry: document.getElementById("storeCountry")?.value || "",
                pickupOption: document.getElementById("pickupOption")?.checked || false,
                deliveryOption: document.getElementById("deliveryOption")?.checked || false,
                shippingCompany: document.getElementById("shippingCompany")?.value || "",
                deliveryFee: document.getElementById("deliveryFee")?.value || "",
                paymentMethods: paymentMethods,
                currency: document.getElementById("currency")?.value || "",
                taxRate: document.getElementById("taxRate")?.value || ""
            };

            console.log("Store Settings:", settings);
            alert("تم حفظ الإعدادات بنجاح!");
        }

        // تحديث معاينة الفاتورة
        function updateInvoicePreview() {
            const preview = document.getElementById('invoicePreview');
            if (!preview) return;

            // قراءة القيم
            const title = document.getElementById('invoiceTitle')?.value || 'فاتورة ضريبية';
            const showProductImage = document.getElementById('showProductImage')?.checked;
            const showProductDesc = document.getElementById('showProductDesc')?.checked;
            const showProductSKU = document.getElementById('showProductSKU')?.checked;
            const showBarcode = document.getElementById('showBarcode')?.checked;
            const showAcknowledgment = document.getElementById('showAcknowledgment')?.checked;
            const showOrderNote = document.getElementById('showOrderNote')?.checked;
            const showReturnPolicy = document.getElementById('showReturnPolicy')?.checked;
            const showStoreAddress = document.getElementById('showStoreAddress')?.checked;
            const showContactInfo = document.getElementById('showContactInfo')?.checked;

            let html = `
                <div class="wd-invoice-header">
                    <h2>${title}</h2>
                    <p>رقم الفاتورة: #INV-2025-001 | التاريخ: 05/02/2025</p>
                </div>
            `;

            // معلومات المتجر
            if (showStoreAddress) {
                html += `
                    <div class="wd-invoice-store-info">
                        <strong>اسم المتجر</strong>
                        الرياض، المملكة العربية السعودية
                        ${showContactInfo ? '<br>هاتف: +966 5XXXXXXXX | البريد: store@example.com' : ''}
                    </div>
                `;
            } else if (showContactInfo) {
                html += `
                    <div class="wd-invoice-store-info">
                        <strong>بيانات التواصل</strong>
                        هاتف: +966 5XXXXXXXX | البريد: store@example.com
                    </div>
                `;
            }

            // معلومات العميل
            html += `
                <div class="wd-invoice-section">
                    <div class="wd-invoice-section-title">معلومات العميل</div>
                    <div style="font-size: 10px;">
                        <strong>الاسم:</strong> محمد أحمد<br>
                        <strong>الهاتف:</strong> +966 5XXXXXXXX<br>
                        <strong>العنوان:</strong> الرياض، حي النخيل
                    </div>
                </div>
            `;

            // المنتجات
            html += `
                <div class="wd-invoice-section">
                    <div class="wd-invoice-section-title">المنتجات</div>
                    <div class="wd-invoice-product">
                        ${showProductImage ? '<div class="wd-invoice-product-img"><i class="fas fa-box"></i></div>' : ''}
                        <div class="wd-invoice-product-details">
                            <div class="wd-invoice-product-name">منتج تجريبي 1</div>
                            ${showProductDesc ? '<div class="wd-invoice-product-desc">وصف قصير للمنتج يوضح مميزاته</div>' : ''}
                            ${showProductSKU ? '<div class="wd-invoice-product-sku">SKU: PRD-001</div>' : ''}
                            <div style="font-size: 9px; color: #666;">الكمية: 2</div>
                        </div>
                        <div class="wd-invoice-product-price">300 ر.س</div>
                    </div>
                    <div class="wd-invoice-product">
                        ${showProductImage ? '<div class="wd-invoice-product-img"><i class="fas fa-box"></i></div>' : ''}
                        <div class="wd-invoice-product-details">
                            <div class="wd-invoice-product-name">منتج تجريبي 2</div>
                            ${showProductDesc ? '<div class="wd-invoice-product-desc">منتج آخر بوصف مختلف</div>' : ''}
                            ${showProductSKU ? '<div class="wd-invoice-product-sku">SKU: PRD-002</div>' : ''}
                            <div style="font-size: 9px; color: #666;">الكمية: 1</div>
                        </div>
                        <div class="wd-invoice-product-price">150 ر.س</div>
                    </div>
                </div>
            `;

            // الإجماليات
            html += `
                <div class="wd-invoice-totals">
                    <div class="wd-invoice-total-row">
                        <span>المجموع الفرعي:</span>
                        <span>450.00 ر.س</span>
                    </div>
                    <div class="wd-invoice-total-row">
                        <span>الضريبة (15%):</span>
                        <span>67.50 ر.س</span>
                    </div>
                    <div class="wd-invoice-total-row">
                        <span>الشحن:</span>
                        <span>25.00 ر.س</span>
                    </div>
                    <div class="wd-invoice-total-row final">
                        <span>الإجمالي:</span>
                        <span>542.50 ر.س</span>
                    </div>
                </div>
            `;

            // ملاحظة الطلب
            if (showOrderNote) {
                html += `
                    <div class="wd-invoice-note">
                        <strong>ملاحظة الطلب:</strong> يرجى التواصل قبل التوصيل
                    </div>
                `;
            }

            // الإقرار
            if (showAcknowledgment) {
                html += `
                    <div class="wd-invoice-acknowledgment">
                        <strong>إقرار:</strong> أقر باستلام الطلب كاملاً وبحالة جيدة
                    </div>
                `;
            }

            // سياسة الاسترجاع
            if (showReturnPolicy) {
                html += `
                    <div class="wd-invoice-policy">
                        <strong>سياسة الاستبدال والاسترجاع:</strong> يمكن استبدال أو استرجاع المنتج خلال 14 يوم من تاريخ الشراء بشرط عدم الاستخدام.
                    </div>
                `;
            }

            // الباركود
            if (showBarcode) {
                html += `
                    <div class="wd-invoice-barcode">
                        <div class="wd-invoice-barcode-img"></div>
                        <div class="wd-invoice-barcode-text">INV-2025-001-XYZ</div>
                    </div>
                `;
            }

            // بيانات التواصل في الأسفل
            if (showContactInfo && !showStoreAddress) {
                html += `
                    <div class="wd-invoice-contact">
                        للاستفسارات: +966 5XXXXXXXX | store@example.com
                    </div>
                `;
            } else if (showContactInfo || showStoreAddress) {
                html += `
                    <div class="wd-invoice-contact">
                        شكراً لتسوقكم معنا!
                    </div>
                `;
            }

            preview.innerHTML = html;
        }

        // حفظ إعدادات الفاتورة
        function saveInvoiceSettings() {
            const settings = {
                title: document.getElementById('invoiceTitle')?.value || '',
                showProductImage: document.getElementById('showProductImage')?.checked || false,
                showProductDesc: document.getElementById('showProductDesc')?.checked || false,
                showProductSKU: document.getElementById('showProductSKU')?.checked || false,
                showBarcode: document.getElementById('showBarcode')?.checked || false,
                showEnglishVersion: document.getElementById('showEnglishVersion')?.checked || false,
                showAcknowledgment: document.getElementById('showAcknowledgment')?.checked || false,
                showOrderNote: document.getElementById('showOrderNote')?.checked || false,
                showReturnPolicy: document.getElementById('showReturnPolicy')?.checked || false,
                autoSendInvoice: document.getElementById('autoSendInvoice')?.checked || false,
                sendOnNew: document.getElementById('sendOnNew')?.checked || false,
                sendOnProcessing: document.getElementById('sendOnProcessing')?.checked || false,
                sendOnShipped: document.getElementById('sendOnShipped')?.checked || false,
                sendOnDelivered: document.getElementById('sendOnDelivered')?.checked || false,
                sendOnCompleted: document.getElementById('sendOnCompleted')?.checked || false,
                showStoreAddress: document.getElementById('showStoreAddress')?.checked || false,
                showContactInfo: document.getElementById('showContactInfo')?.checked || false
            };
            console.log("Invoice Settings:", settings);
            alert("تم حفظ إعدادات الفاتورة بنجاح!");
        }

        // تهيئة معاينة الفاتورة عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(updateInvoicePreview, 100);
        });
    </script>
    <script src="../script.js"></script>
</body>

</html>