<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>وسوم النظام - المحتويات</title>
    <link rel="stylesheet" href="../style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .wd-system-tag-form {
        background-color: #fff;
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 24px;
      }

      .wd-form-group {
        margin-bottom: 24px;
      }

      .wd-form-control {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .wd-form-control:focus {
        border-color: #4a90e2;
        outline: none;
        box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
      }

      .wd-required {
        color: #dc3545;
        margin-right: 4px;
      }

      .wd-error-message {
        color: #dc3545;
        font-size: 0.85em;
        margin-top: 8px;
        display: none;
      }

      /* تنسيق الحقول الجانبية */
      .wd-form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }

      .wd-form-col {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 280px;
      }

      .wd-form-row.auto-fit {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
      }

      .wd-form-row.compact {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }

      /* تنسيق قسم الوسم */
      .wd-tag-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #e9ecef;
        margin-bottom: 20px;
      }

      .wd-tag-section h3 {
        margin: 0 0 15px 0;
        color: #333;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .wd-tag-section .wd-tag-description {
        color: #666;
        font-size: 14px;
        margin-bottom: 15px;
        line-height: 1.5;
      }

      .wd-tag-section .wd-tag-icon {
        font-size: 18px;
      }

      /* ألوان مختلفة لكل قسم */
      .wd-tag-section.new-customer {
        border-right: 4px solid #28a745;
      }

      .wd-tag-section.new-customer .wd-tag-icon {
        color: #28a745;
      }

      .wd-tag-section.vip-customer {
        border-right: 4px solid #ffc107;
      }

      .wd-tag-section.vip-customer .wd-tag-icon {
        color: #ffc107;
      }

      .wd-tag-section.potential-customer {
        border-right: 4px solid #17a2b8;
      }

      .wd-tag-section.potential-customer .wd-tag-icon {
        color: #17a2b8;
      }

      .wd-tag-section.active-customer {
        border-right: 4px solid #007bff;
      }

      .wd-tag-section.active-customer .wd-tag-icon {
        color: #007bff;
      }

      .wd-tag-section.inactive-customer {
        border-right: 4px solid #dc3545;
      }

      .wd-tag-section.inactive-customer .wd-tag-icon {
        color: #dc3545;
      }

      .wd-tag-section.abandoned-cart {
        border-right: 4px solid #fd7e14;
      }

      .wd-tag-section.abandoned-cart .wd-tag-icon {
        color: #fd7e14;
      }

      .wd-tag-section.appointment-booking {
        border-right: 4px solid #6f42c1;
      }

      .wd-tag-section.appointment-booking .wd-tag-icon {
        color: #6f42c1;
      }

      /* تنسيق متجاوب */
      @media screen and (max-width: 768px) {
        .wd-form-row {
          flex-direction: column;
          gap: 0;
        }

        .wd-form-col {
          margin-bottom: 24px;
        }

        .wd-tag-section {
          padding: 15px;
        }
      }

      .wd-form-actions {
        display: flex;
        gap: 15px;
        justify-content: flex-end;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
      }

      .wd-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .wd-btn-primary {
        background: #4a90e2;
        color: white;
      }

      .wd-btn-primary:hover {
        background: #357abd;
      }

      .wd-btn-secondary {
        background: #6c757d;
        color: white;
      }

      .wd-btn-secondary:hover {
        background: #545b62;
      }

      /* تنسيق مفتاح التبديل */
      .wd-toggle-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 50px;
        width: 100%;
        padding-top: 8px;
      }

      .wd-toggle-label {
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        margin: 0;
        width: 44px;
      }

      .wd-toggle-input {
        display: none;
      }

      .wd-toggle-slider {
        position: relative;
        width: 44px;
        height: 22px;
        background-color: #ccc;
        border-radius: 11px;
        transition: background-color 0.3s ease;
      }

      .wd-toggle-slider:before {
        content: "";
        position: absolute;
        top: 2px;
        left: 2px;
        width: 18px;
        height: 18px;
        background-color: white;
        border-radius: 50%;
        transition: transform 0.3s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .wd-toggle-input:checked + .wd-toggle-slider {
        background-color: #4a90e2;
      }

      .wd-toggle-input:checked + .wd-toggle-slider:before {
        transform: translateX(22px);
      }

      /* تحسين تنسيق الحقول */
      .wd-form-row {
        margin-bottom: 20px;
      }

      .wd-form-row:last-child {
        margin-bottom: 0;
      }

      /* تنسيق العمود الأول (المفتاح) */
      .wd-form-row.compact .wd-form-col:first-child {
        flex: 0 0 auto;
        width: 80px;
        min-width: 80px;
        max-width: 80px;
      }

      /* تنسيق حقل اللون */
      .wd-color-picker-col {
        flex: 0 0 auto;
        width: 100px;
        min-width: 10px;
        max-width: 100px;
      }

      .wd-color-picker-col input[type="color"] {
        width: 100%;
        height: 50px;
        padding: 4px;
        cursor: pointer;
      }

      /* تنسيق حقل المتغير المرتبط */
      .wd-variable-col {
        flex: 0 0 auto;
        width: 100px;
        min-width: 100px;
        max-width: 100px;
      }

      /* تنسيق النصوص التوضيحية */
      .wd-vip-settings label {
        font-weight: 500;
        color: #333;
        margin-bottom: 8px;
        display: block;
      }

      /* تنسيق أسماء المتغيرات */
      .wd-variable-name {
        background: #28a745;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        font-size: 12px;
        font-weight: bold;
        display: inline-block;
        margin: 0 2px;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* تنسيق زر إضافة الشرط الجديد */
      .wd-add-condition {
        margin-top: 20px;
        text-align: center;
        padding-top: 15px;
        border-top: 1px solid #e9ecef;
      }

      .wd-btn-outline {
        background: transparent;
        border: 2px solid #4a90e2;
        color: #4a90e2;
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .wd-btn-outline:hover {
        background: #4a90e2;
        color: white;
      }

      /* أنماط الاختيار المتعدد للوسوم */
      .wd-group-search {
        position: relative;
      }

      .wd-group-list {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-radius: 6px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        margin-top: 5px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .wd-group-item {
        padding: 12px 16px;
        cursor: pointer;
        color: #333;
        font-weight: 500;
        transition: all 0.2s ease;
        background: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .wd-group-item:last-child {
        border-bottom: none;
      }

      .wd-group-item:hover {
        background: #e9ecef;
      }

      .wd-group-item.selected {
        background: #e8f5e8;
        color: #2e7d32;
        border-left: 3px solid #2e7d32;
      }

      .wd-group-item.selected::after {
        content: "✓";
        color: #2e7d32;
        font-weight: bold;
        font-size: 16px;
      }

      .wd-group-search input:focus + .wd-group-list {
        display: block;
      }

      .wd-selected-groups {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 8px;
        min-height: 20px;
      }

      .wd-selected-group-tag {
        background: #e8f5e8;
        color: #2e7d32;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        border: 1px solid #a5d6a7;
      }

      .wd-selected-group-tag .remove-btn {
        background: none;
        border: none;
        color: #2e7d32;
        cursor: pointer;
        font-size: 14px;
        padding: 0;
        width: 16px;
        height: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background 0.2s ease;
      }

      .wd-selected-group-tag .remove-btn:hover {
        background: #2e7d32;
        color: white;
      }

      /* تنسيق زر حذف الشرط */
      .wd-remove-action-btn {
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 40px;
        height: 45px;
      }

      .wd-remove-action-btn:hover {
        background: #c82333;
        transform: scale(1.05);
        box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
      }

      .wd-remove-action-btn i {
        font-size: 16px;
      }

      /* تنسيق حقول قسم عميل خامل */
      #inactiveConditionsContainer .wd-form-row .wd-form-col:not(:last-child) {
        flex: 1 1 0;
        max-width: calc(50% - 35px);
      }
    </style>
  </head>
  <body>
    <div class="wd-container">
      <!-- القسم الأول: القائمة الجانبية -->
      <aside class="wd-sidebar">
        <div class="wd-logo">
          <img src="../imgs/logo.png" alt="شعار المنصة" />
        </div>
        <nav class="wd-nav">
          <ul>
            <li class="wd-nav-item">
              <i class="fa-solid fa-gauge"></i>
              <span
                ><a href="../index.html" class="wd-nav-link"
                  >لوحة التحكم</a
                ></span
              >
            </li>
            <li class="wd-nav-item">
              <i class="fa-solid fa-comments"></i>
              <span
                ><a href="../chat.html" class="wd-nav-link">المحادثات</a></span
              >
            </li>
            <li class="wd-nav-item">
              <i class="fa-solid fa-users"></i>
              <span
                ><a href="../contacts.html" class="wd-nav-link"
                  >جهات الاتصال</a
                ></span
              >
            </li>
            <li class="wd-nav-item">
              <i class="fa-solid fa-diagram-project"></i>
              <span
                ><a href="../flows.html" class="wd-nav-link">التدفقات</a></span
              >
            </li>
            <li class="wd-nav-item">
              <i class="fas fa-bullhorn"></i>
              <span
                ><a href="../campaigns.html" class="wd-nav-link"
                  >الحملات</a
                ></span
              >
            </li>
            <li class="wd-nav-item">
              <i class="fas fa-calendar"></i>
              <span
                ><a href="../calendar.html" class="wd-nav-link"
                  >التقويم</a
                ></span
              >
            </li>
            <li class="wd-nav-item active">
              <i class="fas fa-file-alt"></i>
              <span
                ><a href="../contents.html" class="wd-nav-link"
                  >المحتويات</a
                ></span
              >
            </li>
            <li class="wd-nav-item">
              <i class="fas fa-code"></i>
              <span
                ><a href="../developers.html" class="wd-nav-link"
                  >المطورين</a
                ></span
              >
            </li>
            <li class="wd-nav-item">
              <i class="fas fa-cog"></i>
              <span
                ><a href="../settings.html" class="wd-nav-link"
                  >الإعدادات</a
                ></span
              >
            </li>
          </ul>
        </nav>
      </aside>

      <!-- القسم الثاني: القائمة الجانبية الثانية -->
      <div class="wd-secondary-sidebar">
        <div class="wd-account-switcher">
          <div class="wd-account-info">
            <img
              src="../imgs/logo.png"
              alt="صورة الحساب"
              class="wd-account-avatar"
            />
            <div class="wd-account-details">
              <span class="wd-account-name">حساب الشركة</span>
              <span class="wd-account-type">مدير</span>
            </div>
          </div>
          <button class="wd-account-switch">
            <i class="fas fa-exchange-alt"></i>
          </button>
        </div>
        <div class="wd-secondary-content">
          <nav class="wd-secondary-nav">
            <ul>
              <a href="../contents.html" class="wd-nav-link">
                <li class="wd-secondary-nav-item">
                  <i class="fas fa-user-cog"></i>
                  <span>متغيرات المستخدم</span>
                </li>
              </a>
              <a href="../contents/system.html" class="wd-nav-link">
                <li class="wd-secondary-nav-item">
                  <i class="fas fa-cogs"></i>
                  <span>متغيرات النظام</span>
                </li>
              </a>
              <a href="../contents/automation.html" class="wd-nav-link">
                <li class="wd-secondary-nav-item">
                  <i class="fas fa-robot"></i>
                  <span>الرد الآلي</span>
                </li>
              </a>
              <a href="../contents/journies.html" class="wd-nav-link">
                <li class="wd-secondary-nav-item">
                  <i class="fas fa-calendar"></i>
                  <span>رحلة العميل</span>
                </li>
              </a>
              <a href="../contents/tags.html" class="wd-nav-link">
                <li class="wd-secondary-nav-item">
                  <i class="fas fa-tags"></i>
                  <span>الوسوم</span>
                </li>
              </a>
              <a href="../contents/system-tags.html" class="wd-nav-link">
                <li class="wd-secondary-nav-item active">
                  <i class="fas fa-tag"></i>
                  <span>وسوم النظام</span>
                </li>
              </a>
              <a href="../contents/shortcuts.html" class="wd-nav-link">
                <li class="wd-secondary-nav-item">
                  <i class="fas fa-keyboard"></i>
                  <span>الاختصارات</span>
                </li>
              </a>
              <a href="../contents/whatsapp.html" class="wd-nav-link">
                <li class="wd-secondary-nav-item">
                  <i class="fab fa-whatsapp"></i>
                  <span>قوالب الواتساب</span>
                </li>
              </a>
              <a href="../contents/email.html" class="wd-nav-link">
                <li class="wd-secondary-nav-item">
                  <i class="fas fa-envelope"></i>
                  <span
                    >البريد الكتروني
                    <span class="wd-coming-soon">قريباً</span></span
                  >
                </li>
              </a>
              <a href="../contents/sms.html" class="wd-nav-link">
                <li class="wd-secondary-nav-item">
                  <i class="fas fa-comment-dots"></i>
                  <span
                    >الرسائل النصية
                    <span class="wd-coming-soon">قريباً</span></span
                  >
                </li>
              </a>
            </ul>
          </nav>
        </div>
      </div>

      <!-- القسم الثالث: المحتوى الرئيسي -->
      <div class="wd-main-content">
        <div class="wd-content-header">
          <div class="wd-header-left">
            <button
              class="wd-toggle-secondary"
              onclick="toggleSecondarySidebar()"
            >
              <i class="fas fa-bars"></i>
            </button>
            <h1>وسوم النظام</h1>
          </div>
        </div>

        <div class="wd-content-body">
          <form class="wd-system-tag-form" method="POST" action="#">
            <!-- قسم وسم عميل -->
            <div class="wd-tag-section vip-customer" bis_skin_checked="1">
              <h3>
                <i class="fas fa-user-tag wd-tag-icon"></i>
                عميل
              </h3>
              <div class="wd-tag-description" bis_skin_checked="1">
                تعتمد إضافتها عند تحديث المتغير المرتبط بها أو عند إضافة أحد
                الوسوم
              </div>

              <div class="wd-form-row compact" bis_skin_checked="1">
                <!-- زر التفعيل/إلغاء التفعيل -->
                <div class="wd-form-col" bis_skin_checked="1">
                  <label>حالة الوسم</label>
                  <div class="wd-toggle-container" bis_skin_checked="1">
                    <label class="wd-toggle-label">
                      <input
                        type="checkbox"
                        id="customerTagEnabled"
                        class="wd-toggle-input"
                        checked=""
                      />
                      <span class="wd-toggle-slider"></span>
                    </label>
                  </div>
                </div>

                <!-- المتغير المرتبط -->
                <div class="wd-form-col wd-variable-col" bis_skin_checked="1">
                  <label for="linkedVariable">المتغير المرتبط</label>
                  <input
                    type="text"
                    id="linkedVariable"
                    class="wd-form-control"
                    value="{{شراء}}"
                    readonly=""
                    style="background-color: #f8f9fa"
                  />
                </div>

                <!-- منتقي الألوان -->
                <div
                  class="wd-form-col wd-color-picker-col"
                  bis_skin_checked="1"
                >
                  <label for="tagColor">اللون</label>
                  <input
                    type="color"
                    id="tagColor"
                    class="wd-form-control"
                    value="#4a90e2"
                  />
                </div>

                <!-- الوسوم -->
                <div class="wd-form-col" bis_skin_checked="1">
                  <label>اختر الوسوم (يمكن اختيار أكثر من وسم)</label>
                  <div class="wd-group-search" bis_skin_checked="1">
                    <input
                      type="text"
                      id="tagSearch"
                      class="wd-form-control"
                      placeholder="انقر لاختيار الوسوم..."
                      readonly=""
                    />
                    <div
                      class="wd-group-list"
                      id="tagList"
                      style="display: none"
                      bis_skin_checked="1"
                    >
                      <div
                        class="wd-group-item"
                        data-group="VIP"
                        bis_skin_checked="1"
                      >
                        VIP
                      </div>
                      <div
                        class="wd-group-item"
                        data-group="مهتم"
                        bis_skin_checked="1"
                      >
                        مهتم
                      </div>
                      <div
                        class="wd-group-item"
                        data-group="متابعة"
                        bis_skin_checked="1"
                      >
                        متابعة
                      </div>
                      <div
                        class="wd-group-item"
                        data-group="عميل جديد"
                        bis_skin_checked="1"
                      >
                        عميل جديد
                      </div>
                      <div
                        class="wd-group-item"
                        data-group="أولوية"
                        bis_skin_checked="1"
                      >
                        أولوية
                      </div>
                      <div
                        class="wd-group-item"
                        data-group="عميل مميز"
                        bis_skin_checked="1"
                      >
                        عميل مميز
                      </div>
                      <div
                        class="wd-group-item"
                        data-group="عاجل"
                        bis_skin_checked="1"
                      >
                        عاجل
                      </div>
                    </div>
                  </div>
                  <div
                    class="wd-selected-groups"
                    id="selectedTagsDisplay"
                    bis_skin_checked="1"
                  ></div>
                  <input type="hidden" id="selectedTags" />
                </div>
              </div>
            </div>

            <!-- قسم عميل مميز -->
            <div class="wd-tag-section vip-customer" bis_skin_checked="1">
              <h3>
                <i class="fas fa-crown wd-tag-icon"></i>
                عميل مميز
              </h3>

              <div class="wd-tag-description" bis_skin_checked="1">
                يتم إضافة هذا الوسم عند تكرار وسم عميل لأكثر من
              </div>

              <div class="wd-form-row compact" bis_skin_checked="1">
                <!-- زر التفعيل/إلغاء التفعيل -->
                <div class="wd-form-col" bis_skin_checked="1">
                  <label>حالة الوسم</label>
                  <div class="wd-toggle-container" bis_skin_checked="1">
                    <label class="wd-toggle-label">
                      <input
                        type="checkbox"
                        id="vipTagEnabled"
                        class="wd-toggle-input"
                        checked=""
                      />
                      <span class="wd-toggle-slider"></span>
                    </label>
                  </div>
                </div>

                <!-- منتقي الألوان -->
                <div
                  class="wd-form-col wd-color-picker-col"
                  bis_skin_checked="1"
                >
                  <label for="vipTagColor">اللون</label>
                  <input
                    type="color"
                    id="vipTagColor"
                    class="wd-form-control"
                    value="#ffc107"
                  />
                </div>

                <!-- عدد مرات التكرار لوسم عميل -->
                <div class="wd-form-col" bis_skin_checked="1">
                  <label for="customerRepeatCount"
                    >عدد مرات تكرار وسم عميل</label
                  >
                  <input
                    type="number"
                    id="customerRepeatCount"
                    class="wd-form-control"
                    placeholder="3"
                    min="1"
                    max="20"
                    value="3"
                  />
                </div>
              </div>

              <div class="wd-tag-description" bis_skin_checked="1">
                أو عند تكرار وسم حجز موعد لأكثر من
              </div>

              <div class="wd-form-row compact" bis_skin_checked="1">
                <!-- مساحة فارغة للمحاذاة -->
                <div class="wd-form-col" bis_skin_checked="1"></div>

                <!-- مساحة فارغة للمحاذاة -->
                <div
                  class="wd-form-col wd-color-picker-col"
                  bis_skin_checked="1"
                ></div>

                <!-- عدد مرات التكرار لوسم حجز موعد -->
                <div class="wd-form-col" bis_skin_checked="1">
                  <label for="appointmentRepeatCount"
                    >عدد مرات تكرار وسم حجز موعد</label
                  >
                  <input
                    type="number"
                    id="appointmentRepeatCount"
                    class="wd-form-control"
                    placeholder="2"
                    min="1"
                    max="20"
                    value="2"
                  />
                </div>
              </div>
            </div>

            <!-- قسم مهتم/سلة متروكة -->
            <div class="wd-tag-section potential-customer" bis_skin_checked="1">
              <h3>
                <i class="fas fa-user-clock wd-tag-icon"></i>
                مهتم/سلة متروكة
              </h3>

              <div class="wd-form-row compact" bis_skin_checked="1">
                <!-- زر التفعيل/إلغاء التفعيل -->
                <div class="wd-form-col" bis_skin_checked="1">
                  <label>حالة الوسم</label>
                  <div class="wd-toggle-container" bis_skin_checked="1">
                    <label class="wd-toggle-label">
                      <input
                        type="checkbox"
                        id="interestedTagEnabled"
                        class="wd-toggle-input"
                        checked=""
                      />
                      <span class="wd-toggle-slider"></span>
                    </label>
                  </div>
                </div>

                <!-- المتغير المرتبط -->
                <div class="wd-form-col wd-variable-col" bis_skin_checked="1">
                  <label for="interestedVariable">المتغير المرتبط</label>
                  <input
                    type="text"
                    id="interestedVariable"
                    class="wd-form-control"
                    value="{{مهتم}}"
                    readonly=""
                    style="background-color: #f8f9fa"
                  />
                </div>

                <!-- منتقي الألوان -->
                <div
                  class="wd-form-col wd-color-picker-col"
                  bis_skin_checked="1"
                >
                  <label for="interestedTagColor">اللون</label>
                  <input
                    type="color"
                    id="interestedTagColor"
                    class="wd-form-control"
                    value="#17a2b8"
                  />
                </div>

                <!-- الوسوم -->
                <div class="wd-form-col" bis_skin_checked="1">
                  <label>إزالة هذا الوسم عند إضافة أحد الوسوم التالية</label>
                  <div class="wd-group-search" bis_skin_checked="1">
                    <input
                      type="text"
                      id="interestedTagSearch"
                      class="wd-form-control"
                      placeholder="انقر لاختيار الوسوم..."
                      readonly=""
                    />
                    <div
                      class="wd-group-list"
                      id="interestedTagList"
                      style="display: none"
                      bis_skin_checked="1"
                    >
                      <div
                        class="wd-group-item"
                        data-group="عميل"
                        bis_skin_checked="1"
                      >
                        عميل
                      </div>
                      <div
                        class="wd-group-item"
                        data-group="عميل مميز"
                        bis_skin_checked="1"
                      >
                        عميل مميز
                      </div>
                      <div
                        class="wd-group-item"
                        data-group="مكتمل"
                        bis_skin_checked="1"
                      >
                        مكتمل
                      </div>
                      <div
                        class="wd-group-item"
                        data-group="مؤكد"
                        bis_skin_checked="1"
                      >
                        مؤكد
                      </div>
                      <div
                        class="wd-group-item"
                        data-group="تم الشراء"
                        bis_skin_checked="1"
                      >
                        تم الشراء
                      </div>
                    </div>
                  </div>
                  <div
                    class="wd-selected-groups"
                    id="interestedSelectedTagsDisplay"
                    bis_skin_checked="1"
                  ></div>
                  <input type="hidden" id="interestedSelectedTags" />
                </div>
              </div>
            </div>

            <!-- قسم حجز موعد -->
            <div
              class="wd-tag-section appointment-booking"
              bis_skin_checked="1"
            >
              <h3>
                <i class="fas fa-calendar-check wd-tag-icon"></i>
                حجز موعد
              </h3>

              <div class="wd-form-row compact" bis_skin_checked="1">
                <!-- زر التفعيل/إلغاء التفعيل -->
                <div class="wd-form-col" bis_skin_checked="1">
                  <label>حالة الوسم</label>
                  <div class="wd-toggle-container" bis_skin_checked="1">
                    <label class="wd-toggle-label">
                      <input
                        type="checkbox"
                        id="appointmentTagEnabled"
                        class="wd-toggle-input"
                        checked=""
                      />
                      <span class="wd-toggle-slider"></span>
                    </label>
                  </div>
                </div>

                <!-- المتغير المرتبط -->
                <div class="wd-form-col wd-variable-col" bis_skin_checked="1">
                  <label for="appointmentVariable">المتغير المرتبط</label>
                  <input
                    type="text"
                    id="appointmentVariable"
                    class="wd-form-control"
                    value="{{موعد}}"
                    readonly=""
                    style="background-color: #f8f9fa"
                  />
                </div>

                <!-- منتقي الألوان -->
                <div
                  class="wd-form-col wd-color-picker-col"
                  bis_skin_checked="1"
                >
                  <label for="appointmentTagColor">اللون</label>
                  <input
                    type="color"
                    id="appointmentTagColor"
                    class="wd-form-control"
                    value="#6f42c1"
                  />
                </div>
              </div>
            </div>

            <!-- قسم عميل خامل -->
            <div class="wd-tag-section inactive-customer" bis_skin_checked="1">
              <h3>
                <i class="fas fa-user-slash wd-tag-icon"></i>
                عميل خامل
              </h3>
              <div class="wd-tag-description" bis_skin_checked="1">
                يتم إضافة هذا الوسم عندما يكون لديه أحد الوسوم التالية ولم يتم
                تكرارها حسب المدة المحددة ويتم إزالته تلقائياً عند تحديث نفس هذه
                الوسوم
              </div>

              <!-- الصف الأول: مفتاح التفعيل واللون -->
              <div class="wd-form-row compact" bis_skin_checked="1">
                <!-- زر التفعيل/إلغاء التفعيل -->
                <div class="wd-form-col" bis_skin_checked="1">
                  <label>حالة الوسم</label>
                  <div class="wd-toggle-container" bis_skin_checked="1">
                    <label class="wd-toggle-label">
                      <input
                        type="checkbox"
                        id="inactiveTagEnabled"
                        class="wd-toggle-input"
                        checked=""
                      />
                      <span class="wd-toggle-slider"></span>
                    </label>
                  </div>
                </div>

                <!-- منتقي الألوان -->
                <div
                  class="wd-form-col wd-color-picker-col"
                  bis_skin_checked="1"
                >
                  <label for="inactiveTagColor">اللون</label>
                  <input
                    type="color"
                    id="inactiveTagColor"
                    class="wd-form-control"
                    value="#dc3545"
                  />
                </div>
              </div>

              <!-- حاوية الشروط -->
              <div id="inactiveConditionsContainer" bis_skin_checked="1">
                <!-- الشرط الأول -->
                <div
                  class="wd-form-row compact"
                  style="margin-top: 15px"
                  bis_skin_checked="1"
                >
                  <!-- الوسم -->
                  <div class="wd-form-col" bis_skin_checked="1">
                    <label for="inactiveTag1">الوسم</label>
                    <select id="inactiveTag1" class="wd-form-control">
                      <option value="">اختر الوسم</option>
                      <option value="عميل">عميل</option>
                      <option value="مهتم">مهتم</option>
                      <option value="متابعة">متابعة</option>
                      <option value="عميل جديد">عميل جديد</option>
                      <option value="أولوية">أولوية</option>
                    </select>
                  </div>

                  <!-- المدة بعد إضافة هذا الوسم -->
                  <div class="wd-form-col" bis_skin_checked="1">
                    <label for="inactiveDays1">المدة بعد إضافة هذا الوسم</label>
                    <input
                      type="number"
                      id="inactiveDays1"
                      class="wd-form-control"
                      placeholder="30"
                      min="1"
                      max="365"
                      value="30"
                    />
                  </div>

                  <!-- زر الحذف -->
                  <div
                    class="wd-form-col"
                    style="flex: 0 0 auto; width: 50px; min-width: 50px"
                    bis_skin_checked="1"
                  >
                    <label style="opacity: 0">حذف</label>
                    <button
                      type="button"
                      class="wd-remove-action-btn"
                      onclick="removeInactiveCondition(this)"
                      style="width: 100%; display: flex"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
                <div
                  class="wd-form-row compact"
                  bis_skin_checked="1"
                  style="margin-top: 15px"
                >
                  <!-- الوسم -->
                  <div class="wd-form-col" bis_skin_checked="1">
                    <label for="inactiveTag2">الوسم</label>
                    <select id="inactiveTag2" class="wd-form-control">
                      <option value="">اختر الوسم</option>
                      <option value="عميل">عميل</option>
                      <option value="مهتم">مهتم</option>
                      <option value="متابعة">متابعة</option>
                      <option value="عميل جديد">عميل جديد</option>
                      <option value="أولوية">أولوية</option>
                    </select>
                  </div>

                  <!-- المدة بعد إضافة هذا الوسم -->
                  <div class="wd-form-col" bis_skin_checked="1">
                    <label for="inactiveDays2">المدة بعد إضافة هذا الوسم</label>
                    <input
                      type="number"
                      id="inactiveDays2"
                      class="wd-form-control"
                      placeholder="30"
                      min="1"
                      max="365"
                      value="30"
                    />
                  </div>

                  <!-- زر الحذف -->
                  <div
                    class="wd-form-col"
                    style="flex: 0 0 auto; width: 50px; min-width: 50px"
                    bis_skin_checked="1"
                  >
                    <label style="opacity: 0">حذف</label>
                    <button
                      type="button"
                      class="wd-remove-action-btn"
                      onclick="removeInactiveCondition(this)"
                      style="width: 100%; display: flex"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
                <div
                  class="wd-form-row compact"
                  bis_skin_checked="1"
                  style="margin-top: 15px"
                >
                  <!-- الوسم -->
                  <div class="wd-form-col" bis_skin_checked="1">
                    <label for="inactiveTag3">الوسم</label>
                    <select id="inactiveTag3" class="wd-form-control">
                      <option value="">اختر الوسم</option>
                      <option value="عميل">عميل</option>
                      <option value="مهتم">مهتم</option>
                      <option value="متابعة">متابعة</option>
                      <option value="عميل جديد">عميل جديد</option>
                      <option value="أولوية">أولوية</option>
                    </select>
                  </div>

                  <!-- المدة بعد إضافة هذا الوسم -->
                  <div class="wd-form-col" bis_skin_checked="1">
                    <label for="inactiveDays3">المدة بعد إضافة هذا الوسم</label>
                    <input
                      type="number"
                      id="inactiveDays3"
                      class="wd-form-control"
                      placeholder="30"
                      min="1"
                      max="365"
                      value="30"
                    />
                  </div>

                  <!-- زر الحذف -->
                  <div
                    class="wd-form-col"
                    style="flex: 0 0 auto; width: 50px; min-width: 50px"
                    bis_skin_checked="1"
                  >
                    <label style="opacity: 0">حذف</label>
                    <button
                      type="button"
                      class="wd-remove-action-btn"
                      onclick="removeInactiveCondition(this)"
                      style="width: 100%; display: flex"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
                <div
                  class="wd-form-row compact"
                  bis_skin_checked="1"
                  style="margin-top: 15px"
                >
                  <!-- الوسم -->
                  <div class="wd-form-col" bis_skin_checked="1">
                    <label for="inactiveTag4">الوسم</label>
                    <select id="inactiveTag4" class="wd-form-control">
                      <option value="">اختر الوسم</option>
                      <option value="عميل">عميل</option>
                      <option value="مهتم">مهتم</option>
                      <option value="متابعة">متابعة</option>
                      <option value="عميل جديد">عميل جديد</option>
                      <option value="أولوية">أولوية</option>
                    </select>
                  </div>

                  <!-- المدة بعد إضافة هذا الوسم -->
                  <div class="wd-form-col" bis_skin_checked="1">
                    <label for="inactiveDays4">المدة بعد إضافة هذا الوسم</label>
                    <input
                      type="number"
                      id="inactiveDays4"
                      class="wd-form-control"
                      placeholder="30"
                      min="1"
                      max="365"
                      value="30"
                    />
                  </div>

                  <!-- زر الحذف -->
                  <div
                    class="wd-form-col"
                    style="flex: 0 0 auto; width: 50px; min-width: 50px"
                    bis_skin_checked="1"
                  >
                    <label style="opacity: 0">حذف</label>
                    <button
                      type="button"
                      class="wd-remove-action-btn"
                      onclick="removeInactiveCondition(this)"
                      style="width: 100%; display: flex"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>

              <!-- زر إضافة وسم جديد -->
              <div class="wd-add-condition" bis_skin_checked="1">
                <button
                  type="button"
                  class="wd-btn"
                  onclick="addInactiveCondition()"
                >
                  <i class="fas fa-plus"></i>
                  إضافة وسم جديد
                </button>
              </div>
            </div>

            <div class="wd-form-actions" bis_skin_checked="1">
              <button type="submit" class="wd-btn">
                <i class="fas fa-save"></i>
                حفظ الإعدادات
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="wd-profile-floating">
      <button class="wd-profile-floating-btn" id="profileFloatingBtn">
        <i class="fas fa-user"></i>
      </button>
      <div class="wd-profile-floating-menu" id="profileFloatingMenu">
        <div class="wd-profile-floating-header">
          <img
            src="../imgs/logo.png"
            alt="صورة المستخدم"
            class="wd-profile-floating-avatar"
          />
          <div class="wd-profile-floating-info">
            <span class="wd-profile-floating-name">اسم المستخدم</span>
            <span class="wd-profile-floating-email">user@example.com</span>
          </div>
        </div>
        <div class="wd-profile-floating-status">
          <span class="wd-profile-floating-status-title">تعيين نفسك ك:</span>
          <div class="wd-profile-floating-status-options">
            <button
              class="wd-profile-floating-status-option active"
              data-status="available"
            >
              <i class="fas fa-circle"></i>
              <span>متصل</span>
            </button>
            <button
              class="wd-profile-floating-status-option"
              data-status="busy"
            >
              <i class="fas fa-circle"></i>
              <span>مشغول</span>
            </button>
            <button
              class="wd-profile-floating-status-option"
              data-status="offline"
            >
              <i class="fas fa-circle"></i>
              <span>غير متصل</span>
            </button>
          </div>
        </div>
        <div class="wd-profile-floating-actions">
          <a href="#" class="wd-profile-floating-action">
            <i class="fas fa-user-cog"></i>
            <span>إعدادات الحساب</span>
          </a>
          <a href="#" class="wd-profile-floating-action">
            <i class="fas fa-palette"></i>
            <span>تغيير المظهر</span>
          </a>
          <a href="#" class="wd-profile-floating-action">
            <i class="fas fa-sign-out-alt"></i>
            <span>تسجيل الخروج</span>
          </a>
        </div>
      </div>
    </div>

    <script src="../script.js"></script>
    <script>
      let conditionCounter = 1;
      let pickedTags = [];

      // تهيئة اختيار الوسوم
      function initializeTagSelection() {
        const tagSearch = document.getElementById("tagSearch");
        const tagList = document.getElementById("tagList");
        const selectedTags = document.getElementById("selectedTags");
        const tagItems = tagList.querySelectorAll(".wd-group-item");

        if (!tagSearch || !tagList) return;

        tagSearch.addEventListener("click", () => {
          tagList.style.display =
            tagList.style.display === "block" ? "none" : "block";
        });

        // إغلاق القائمة عند النقر خارجها
        document.addEventListener("click", (e) => {
          if (!tagSearch.contains(e.target) && !tagList.contains(e.target)) {
            tagList.style.display = "none";
          }
        });

        function refreshPickedTagsUI() {
          // تحديث الحقل المخفي
          if (selectedTags) selectedTags.value = JSON.stringify(pickedTags);

          // تحديث المؤشرات المرئية في القائمة المنسدلة
          tagItems.forEach((item) => {
            const tag = item.dataset.group;
            if (pickedTags.includes(tag)) {
              item.classList.add("selected");
            } else {
              item.classList.remove("selected");
            }
          });

          // تحديث عرض الوسوم المختارة
          const displayContainer = document.getElementById(
            "selectedTagsDisplay"
          );
          if (displayContainer) {
            displayContainer.innerHTML = "";

            pickedTags.forEach((tag) => {
              const tagElement = document.createElement("div");
              tagElement.className = "wd-selected-group-tag";
              tagElement.innerHTML = `
                <span>${tag}</span>
                <button type="button" class="remove-btn" onclick="removeTag('${tag}')">×</button>
              `;
              displayContainer.appendChild(tagElement);
            });

            // تحديث النص التوضيحي في حقل البحث
            if (pickedTags.length > 0) {
              tagSearch.placeholder = `تم اختيار ${pickedTags.length} وسم`;
            } else {
              tagSearch.placeholder = "انقر لاختيار الوسوم...";
            }
          }
        }

        // إضافة دالة عامة لإزالة الوسوم
        window.removeTag = function (tagName) {
          const index = pickedTags.indexOf(tagName);
          if (index > -1) {
            pickedTags.splice(index, 1);
            refreshPickedTagsUI();
          }
        };

        tagItems.forEach((item) => {
          item.addEventListener("click", () => {
            const tag = item.dataset.group;
            const idx = pickedTags.indexOf(tag);
            if (idx === -1) pickedTags.push(tag);
            else pickedTags.splice(idx, 1);
            refreshPickedTagsUI();
          });
        });
      }

      // تهيئة اختيار الوسوم للقسم الثالث (مهتم/سلة متروكة)
      let pickedInterestedTags = [];

      function initializeInterestedTagSelection() {
        const tagSearch = document.getElementById("interestedTagSearch");
        const tagList = document.getElementById("interestedTagList");
        const selectedTags = document.getElementById("interestedSelectedTags");
        const tagItems = tagList.querySelectorAll(".wd-group-item");

        if (!tagSearch || !tagList) return;

        tagSearch.addEventListener("click", () => {
          tagList.style.display =
            tagList.style.display === "block" ? "none" : "block";
        });

        // إغلاق القائمة عند النقر خارجها
        document.addEventListener("click", (e) => {
          if (!tagSearch.contains(e.target) && !tagList.contains(e.target)) {
            tagList.style.display = "none";
          }
        });

        function refreshPickedTagsUI() {
          // تحديث الحقل المخفي
          if (selectedTags)
            selectedTags.value = JSON.stringify(pickedInterestedTags);

          // تحديث المؤشرات المرئية في القائمة المنسدلة
          tagItems.forEach((item) => {
            const tag = item.dataset.group;
            if (pickedInterestedTags.includes(tag)) {
              item.classList.add("selected");
            } else {
              item.classList.remove("selected");
            }
          });

          // تحديث عرض الوسوم المختارة
          const displayContainer = document.getElementById(
            "interestedSelectedTagsDisplay"
          );
          if (displayContainer) {
            displayContainer.innerHTML = "";

            pickedInterestedTags.forEach((tag) => {
              const tagElement = document.createElement("div");
              tagElement.className = "wd-selected-group-tag";
              tagElement.innerHTML = `
                <span>${tag}</span>
                <button type="button" class="remove-btn" onclick="removeInterestedTag('${tag}')">×</button>
              `;
              displayContainer.appendChild(tagElement);
            });

            // تحديث النص التوضيحي في حقل البحث
            if (pickedInterestedTags.length > 0) {
              tagSearch.placeholder = `تم اختيار ${pickedInterestedTags.length} وسم`;
            } else {
              tagSearch.placeholder = "انقر لاختيار الوسوم...";
            }
          }
        }

        // إضافة دالة عامة لإزالة الوسوم
        window.removeInterestedTag = function (tagName) {
          const index = pickedInterestedTags.indexOf(tagName);
          if (index > -1) {
            pickedInterestedTags.splice(index, 1);
            refreshPickedTagsUI();
          }
        };

        tagItems.forEach((item) => {
          item.addEventListener("click", () => {
            const tag = item.dataset.group;
            const idx = pickedInterestedTags.indexOf(tag);
            if (idx === -1) pickedInterestedTags.push(tag);
            else pickedInterestedTags.splice(idx, 1);
            refreshPickedTagsUI();
          });
        });
      }

      // تهيئة عند تحميل الصفحة
      document.addEventListener("DOMContentLoaded", function () {
        initializeTagSelection();
        initializeInterestedTagSelection();
        updateInactiveRemoveButtonsVisibility();
      });

      // نظام إدارة شروط العميل الخامل
      let inactiveConditionCounter = 1;

      function addInactiveCondition() {
        inactiveConditionCounter++;
        const container = document.getElementById(
          "inactiveConditionsContainer"
        );

        const newCondition = document.createElement("div");
        newCondition.className = "wd-form-row compact";
        newCondition.style.marginTop = "15px";
        newCondition.innerHTML = `
          <!-- الوسم -->
          <div class="wd-form-col">
            <label for="inactiveTag${inactiveConditionCounter}">الوسم</label>
            <select id="inactiveTag${inactiveConditionCounter}" class="wd-form-control">
              <option value="">اختر الوسم</option>
              <option value="عميل">عميل</option>
              <option value="مهتم">مهتم</option>
              <option value="متابعة">متابعة</option>
              <option value="عميل جديد">عميل جديد</option>
              <option value="أولوية">أولوية</option>
            </select>
          </div>

          <!-- المدة بعد إضافة هذا الوسم -->
          <div class="wd-form-col">
            <label for="inactiveDays${inactiveConditionCounter}">المدة بعد إضافة هذا الوسم</label>
            <input
              type="number"
              id="inactiveDays${inactiveConditionCounter}"
              class="wd-form-control"
              placeholder="30"
              min="1"
              max="365"
              value="30"
            />
          </div>

          <!-- زر الحذف -->
          <div class="wd-form-col" style="flex: 0 0 auto; width: 50px; min-width: 50px;">
            <label style="opacity: 0;">حذف</label>
            <button
              type="button"
              class="wd-remove-action-btn"
              onclick="removeInactiveCondition(this)"
              style="width: 100%;"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
        `;

        container.appendChild(newCondition);
        updateInactiveRemoveButtonsVisibility();
      }

      function removeInactiveCondition(button) {
        const conditionRow = button.closest(".wd-form-row");
        conditionRow.remove();
        updateInactiveRemoveButtonsVisibility();
      }

      function updateInactiveRemoveButtonsVisibility() {
        const container = document.getElementById(
          "inactiveConditionsContainer"
        );
        const conditions = container.querySelectorAll(".wd-form-row");
        const removeButtons = container.querySelectorAll(
          ".wd-remove-action-btn"
        );

        if (conditions.length === 1) {
          removeButtons.forEach((btn) => (btn.style.display = "none"));
        } else {
          removeButtons.forEach((btn) => (btn.style.display = "flex"));
        }
      }

      function addNewCondition() {
        const inactiveSection = document.querySelector(
          ".wd-tag-section.inactive-customer"
        );
        const addConditionDiv = document.querySelector(".wd-add-condition");

        // إنشاء قسم جديد
        const newConditionDiv = document.createElement("div");
        newConditionDiv.className = "wd-form-row compact";
        newConditionDiv.innerHTML = `
          <div class="wd-form-col">
            <div class="wd-toggle-container">
              <label class="wd-toggle-label">
                <input
                  type="checkbox"
                  id="inactiveCustomerEnabled${conditionCounter}"
                  class="wd-toggle-input"
                  checked
                />
                <span class="wd-toggle-slider"></span>
              </label>
            </div>
          </div>
          <div class="wd-form-col">
            <label for="inactiveCustomerTag${conditionCounter}">الوسم</label>
            <select
              id="inactiveCustomerTag${conditionCounter}"
              class="wd-form-control"
            >
              <option value="">اختر الوسم</option>
              <option value="inactive">خامل</option>
              <option value="dormant">نائم</option>
              <option value="inactive-user">مستخدم خامل</option>
              <option value="no-activity">بدون نشاط</option>
              <option value="disengaged">غير متفاعل</option>
              <option value="lost">مفقود</option>
              <option value="churned">منسحب</option>
            </select>
            <div
              class="wd-error-message"
              id="inactiveCustomerError${conditionCounter}"
            ></div>
          </div>
          <div class="wd-form-col">
            <label for="inactiveCustomerDays${conditionCounter}">الوقت بعد الإضافة</label>
            <input
              type="number"
              id="inactiveCustomerDays${conditionCounter}"
              class="wd-form-control"
              placeholder="30"
              min="1"
              max="365"
              value="30"
            />
          </div>
        `;

        // إدراج القسم الجديد قبل زر إضافة الشرط
        inactiveSection.insertBefore(newConditionDiv, addConditionDiv);

        // زيادة العداد
        conditionCounter++;
      }
    </script>
  </body>
</html>
